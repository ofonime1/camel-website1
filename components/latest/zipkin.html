<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Zipkin Component - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/components/latest/zipkin.html"> <meta name="generator" content="Antora 2.1.0"> <link rel="stylesheet" href="../../_/css/site-1c739ae396.css"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../.."><span>Apache Camel</span></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item" href="../../blog/">Blog</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Projects</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../projects/camel-k/">Camel K</a> <a class="navbar-item" href="../../projects/camel-quarkus/">Camel Quarkus</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Documentation</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../docs/getting-started/">Getting started</a> <a class="navbar-item" href="../../manual/latest/">User manual</a> <a class="navbar-item" href="../../components/latest/">Component reference</a> <a class="navbar-item" href="../../camel-k/latest/">Camel K</a> <a class="navbar-item" href="../../camel-quarkus/latest/">Camel Quarkus</a> <a class="navbar-item" href="../../manual/latest/enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <a class="navbar-item" href="../../manual/latest/camel-3-migration-guide.html">Camel 3 Migration Guide</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Community</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../community/support/">Support</a> <a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a> <a class="navbar-item" href="../../community/user-stories/">User stories</a> <a class="navbar-item" href="../../community/articles/">Articles</a> <a class="navbar-item" href="../../community/books/">Books</a> <a class="navbar-item" href="../../community/team/">Team</a> </div> </div> <a class="navbar-item" href="../../download/">Download</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">About</a> <div class="navbar-dropdown"> <a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a> <a class="navbar-item" href="https://www.apache.org/licenses/">License</a> <a class="navbar-item" href="../../security/">Security</a> <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div> </div> </div> <div class="navbar-tools"> <a href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#github"/></svg></a> <a href="https://gitter.im/apache/apache-camel" title="Chat on Gitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#gitter"/></svg></a> <a href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <div class="body"> <div class="nav-container" data-component="components" data-version="latest"> <aside class="nav"> <div class="panels"> <div class="nav-panel-explore is-active" data-panel="explore"> <div class="context"> <span class="title">Component reference</span> <span class="version">latest</span> </div> <ul class="components"> <li class="component"> <span class="title">Apache Camel extensions for Quarkus</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-quarkus/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Apache Camel K</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-k/latest/index.html">latest</a> </li> </ul> </li> <li class="component is-current"> <span class="title">Component reference</span> <ul class="versions"> <li class="version is-current is-latest"> <a href="index.html">latest</a> </li> <li class="version"> <a href="../2.x/index.html">2.x</a> </li> </ul> </li> <li class="component"> <span class="title">User manual</span> <ul class="versions"> <li class="version is-latest"> <a href="../../manual/latest/index.html">latest</a> </li> </ul> </li> </ul> </div> </div> </aside> </div> <main role="main"> <div class="toolbar" role="navigation"> <button class="nav-toggle"></button> <a href="../../manual/latest/index.html" class="home-link"></a> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">Component reference</a></li> <li><a href="zipkin.html">Zipkin Component</a></li> </ul> </nav> <div class="page-versions"> <button class="version-menu-toggle" title="Show other versions of page" type="button">latest</button> <div class="version-menu"> <a class="version is-current" href="zipkin.html">latest</a> <a class="version" href="../2.x/zipkin.html">2.x</a> </div> </div> <div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/components/camel-zipkin/src/main/docs/zipkin.adoc">Edit this Page</a></div> </div> <article class="doc"> <h1 class="page">Zipkin Component</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.18</strong></p> </div> <div class="paragraph"> <p>The Camel Zipkin component is used for tracing and timing incoming and outgoing Camel messages using <a href="http://zipkin.io/">zipkin</a>.</p> </div> <div class="paragraph"> <p>Events (span) are captured for incoming and outgoing messages being sent to/from Camel.</p> </div> <div class="paragraph"> <p>This means you need to configure which Camel endpoints map to zipkin service names.</p> </div> <div class="paragraph"> <p>The mapping can be configured using:</p> </div> <div class="ulist"> <ul> <li> <p>route id - A Camel route id</p> </li> <li> <p>endpoint url - A Camel endpoint url</p> </li> </ul> </div> <div class="paragraph"> <p>For both kinds you can match using wildcards and regular expressions, using the rules from Intercept.</p> </div> <div class="paragraph"> <p>To match all Camel messages you can use * in the pattern and configure that to the same service name.</p> </div> <div class="paragraph"> <p>If no mapping has been configured, Camel will fallback and use endpoint uri&#8217;s as service names. <br> However, it&#8217;s recommended to configure service mappings so you can use human-readable names instead of Camel endpoint uris in the names.</p> </div> <div class="paragraph"> <p>Camel will auto-configure a span reporter one hasn&#8217;t been explicitly configured, and if the hostname and port to a zipkin collector has been configured as environment variables</p> </div> <div class="ulist"> <ul> <li> <p>ZIPKIN_COLLECTOR_HTTP_SERVICE_HOST - The http hostname</p> </li> <li> <p>ZIPKIN_COLLECTOR_HTTP_SERVICE_PORT - The port number</p> </li> </ul> </div> <div class="paragraph"> <p>or</p> </div> <div class="ulist"> <ul> <li> <p>ZIPKIN_COLLECTOR_THRIFT_SERVICE_HOST - The Scribe (Thrift RPC) hostname</p> </li> <li> <p>ZIPKIN_COLLECTOR_THRIFT_SERVICE_PORT - The port number</p> </li> </ul> </div> <div class="paragraph"> <p>This makes it easy to use camel-zipkin in container platforms where the platform can run your application in a linux container where service configurations are provided as environment variables.</p> </div> </div> </div> <div class="sect1"> <h2 id="camel-zipkin-Options"><a class="anchor" href="#camel-zipkin-Options"></a>Options</h2> <div class="sectionbody"> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Option</th> <th class="tableblock halign-left valign-top">Default</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">rate</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">1.0f</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Configures a rate that decides how many events should be traced by zipkin. The rate is expressed as a percentage (1.0f = 100%, 0.5f is 50%, 0.1f is 10%).</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">spanReporter</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mandatory:</strong> The reporter to use for sending zipkin span events to the zipkin server.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">serviceName</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">To use a global service name that matches all Camel events</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">clientServiceMappings</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the <strong>client</strong> service mappings that matches Camel events to the given zipkin service name. The content is a Map&lt;String, String&gt; where the key is a pattern and the value is the service name. The pattern uses the rules from Intercept.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">serverServiceMappings</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the <strong>server</strong> service mappings that matches Camel events to the given zipkin service name. The content is a Map&lt;String, String&gt; where the key is a pattern and the value is the service name. The pattern uses the rules from Intercept.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">excludePatterns</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets exclude pattern(s) that will disable tracing with zipkin for Camel messages that matches the pattern. The content is a Set&lt;String&gt; where the key is a pattern. The pattern uses the rules from Intercept.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">includeMessageBody</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the Camel message body in the zipkin traces. This is not recommended for production usage, or when having big payloads. You can limit the size by configuring the <a href="../../manual/latest/faq/how-do-i-set-the-max-chars-when-debug-logging-messages-in-camel.html" class="page">max debug log size</a>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">includeMessageBodyStreams</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include message bodies that are stream based in the zipkin traces. This requires enabling streamcaching on the routes or globally on the CamelContext. This is not recommended for production usage, or when having big payloads. You can limit the size by configuring the <a href="../../manual/latest/faq/how-do-i-set-the-max-chars-when-debug-logging-messages-in-camel.html" class="page">max debug log size</a>.</p></td> </tr> </tbody> </table></div> </div> </div> <div class="sect1"> <h2 id="_spring_boot_auto_configuration"><a class="anchor" href="#_spring_boot_auto_configuration"></a>Spring Boot Auto-Configuration</h2> <div class="sectionbody"> <div class="paragraph"> <p>When using Spring Boot make sure to use the following Maven dependency to have support for auto configuration:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-zipkin-starter&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
  &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The component supports 10 options, which are listed below.</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.client-service-mappings</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets client service mapping(s) that matches Camel events to the given zipkin service name. The key is the pattern, the value is the service name.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.endpoint</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the POST URL for zipkin&#8217;s &lt;a href="http://zipkin.io/zipkin-api/#/"&gt;v2 api&lt;/a&gt;, usually "\http://zipkinhost:9411/api/v2/spans"</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.exclude-patterns</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets exclude pattern(s) that will disable tracing with zipkin for Camel messages that matches the pattern.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.host-name</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the hostname if sending spans to a remote zipkin scribe (thrift RPC) collector.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.include-message-body</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the Camel message body in the zipkin traces. This is not recommended for production usage, or when having big payloads. You can limit the size by configuring camel.springboot.log-debug-max-chars option.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.include-message-body-streams</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include message bodies that are stream based in the zipkin traces. This is not recommended for production usage, or when having big payloads. You can limit the size by configuring camel.springboot.log-debug-max-chars option.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.port</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the port if sending spans to a remote zipkin scribe (thrift RPC) collector.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.rate</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Configures a rate that decides how many events should be traced by zipkin. The rate is expressed as a percentage (1.0f = 100%, 0.5f is 50%, 0.1f is 10%).</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.server-service-mappings</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets server service mapping(s) that matches Camel events to the given zipkin service name. The key is the pattern, the value is the service name.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>camel.zipkin.service-name</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">To use a global service name that matches all Camel events</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> </tbody> </table></div> </div> </div> <div class="sect1"> <h2 id="camel-zipkin-Example"><a class="anchor" href="#camel-zipkin-Example"></a>Example</h2> <div class="sectionbody"> <div class="paragraph"> <p>To enable camel-zipkin you need to configure first</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ZipkinTracer zipkin = new ZipkinTracer();
// Configure a reporter, which controls how often spans are sent
//   (the dependency is io.zipkin.reporter2:zipkin-sender-okhttp3)
sender = OkHttpSender.create("http://127.0.0.1:9411/api/v2/spans");
zipkin.setSpanReporter(AsyncReporter.create(sender));
// and then add zipkin to the CamelContext
zipkin.init(camelContext);</code></pre> </div> </div> <div class="paragraph"> <p>The configuration above will trace all incoming and outgoing messages in Camel routes.</p> </div> <div class="paragraph"> <p>To use ZipkinTracer in XML, all you need to do is to define scribe and zipkin tracer beans. Camel will automatically discover and use them.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;!-- configure how to reporter spans to a Zipkin collector
          (the dependency is io.zipkin.reporter2:zipkin-reporter-spring-beans) --&gt;
  &lt;bean id="http" class="zipkin2.reporter.beans.AsyncReporterFactoryBean"&gt;
    &lt;property name="sender"&gt;
      &lt;bean id="sender" class="zipkin2.reporter.beans.OkHttpSenderFactoryBean"&gt;
        &lt;property name="endpoint" value="http://localhost:9411/api/v2/spans"/&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;!-- wait up to half a second for any in-flight spans on close --&gt;
    &lt;property name="closeTimeout" value="500"/&gt;
  &lt;/bean&gt;

  &lt;!-- setup zipkin tracer --&gt;
  &lt;bean id="zipkinTracer" class="org.apache.camel.zipkin.ZipkinTracer"&gt;
    &lt;property name="serviceName" value="dude"/&gt;
    &lt;property name="spanReporter" ref="http"/&gt;
  &lt;/bean&gt;</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="camel-zipkin-ServiceName"><a class="anchor" href="#camel-zipkin-ServiceName"></a>ServiceName</h2> <div class="sectionbody"> <div class="paragraph"> <p>However, if you want to map Camel endpoints to human friendly logical names, you can add mappings</p> </div> <div class="ulist"> <ul> <li> <p>ServiceName *</p> </li> </ul> </div> <div class="paragraph"> <p>You can configure a global service name that all events will fallback and use, such as:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">zipkin.setServiceName("invoices");</code></pre> </div> </div> <div class="paragraph"> <p>This will use the same service name for all incoming and outgoing zipkin traces. If your application uses different services, you should map them to more finely grained client / server service mappings</p> </div> </div> </div> <div class="sect1"> <h2 id="camel-zipkin-ClientandServerServiceMappings"><a class="anchor" href="#camel-zipkin-ClientandServerServiceMappings"></a>Client and Server Service Mappings</h2> <div class="sectionbody"> <div class="ulist"> <ul> <li> <p>ClientServiceMappings</p> </li> <li> <p>ServerServiceMappings</p> </li> </ul> </div> <div class="paragraph"> <p>If your application hosts a service that others can call, you can map the Camel route endpoint to a server service mapping. For example, suppose your Camel application has the following route:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("activemq:queue:inbox")
  .to("http:someserver/somepath");</code></pre> </div> </div> <div class="paragraph"> <p>And you want to make that as a server service, you can add the following mapping:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">zipkin.addServerServiceMapping("activemq:queue:inbox", "orders");</code></pre> </div> </div> <div class="paragraph"> <p>Then when a message is consumed from that inbox queue, it becomes a zipkin server event with the service name 'orders'.</p> </div> <div class="paragraph"> <p>Now suppose that the call to http:someserver/somepath is also a service, which you want to map to a client service name, which can be done as:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">zipkin.addClientServiceMapping("http:someserver/somepath", "audit");</code></pre> </div> </div> <div class="paragraph"> <p>Then in the same Camel application you have mapped incoming and outgoing endpoints to different zipkin service names.</p> </div> <div class="paragraph"> <p>You can use wildcards in the service mapping. To match all outgoing calls to the same HTTP server you can do:</p> </div> <div class="listingblock"> <div class="content"> <pre>zipkin.addClientServiceMapping("http:someserver*", "audit");</pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="camel-zipkin-Mappingrules"><a class="anchor" href="#camel-zipkin-Mappingrules"></a>Mapping rules</h2> <div class="sectionbody"> <div class="paragraph"> <p>The service name mapping for server occurs using the following rules</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Is there an exclude pattern that matches the endpoint uri of the from endpoint? If yes then skip.</p> </li> <li> <p>Is there a match in the serviceServiceMapping that matches the endpoint uri of the from endpoint? If yes, then use the found service name</p> </li> <li> <p>Is there a match in the serviceServiceMapping that matches the route id of the current route? If yes, then use the found service name</p> </li> <li> <p>Is there a match in the serviceServiceMapping that matches the original route id where the exchange started? If yes, then use the found service name</p> </li> <li> <p>No service name was found, the exchange is not traced by zipkin</p> </li> </ol> </div> <div class="paragraph"> <p>The service name mapping for client occurs using the following rules</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Is there an exclude pattern that matches the endpoint uri of the from endpoint? If yes then skip.</p> </li> <li> <p>Is there a match in the clientServiceMapping that matches the endpoint uri of endpoint where the message is being sent to? If yes, then use the found service name</p> </li> <li> <p>Is there a match in the clientServiceMapping that matches the route id of the current route? If yes, then use the found service name</p> </li> <li> <p>Is there a match in the clientServiceMapping that matches the original route id where the exchange started? If yes, then use the found service name</p> </li> <li> <p>No service name was found, the exchange is not traced by zipkin</p> </li> </ol> </div> </div> </div> <div class="sect1"> <h2 id="camel-zipkin-Noclientorservermappings"><a class="anchor" href="#camel-zipkin-Noclientorservermappings"></a>No client or server mappings</h2> <div class="sectionbody"> <div class="paragraph"> <p>If there has been no configuration of client or server service mappings, CamelZipkin runs in a fallback mode, and uses endpoint uris as the service name.</p> </div> <div class="paragraph"> <p>In the example above, this would mean the service names would be defined as if you add the following code yourself:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">zipkin.addServerServiceMapping("activemq:queue:inbox", "activemq:queue:inbox");
zipkin.addClientServiceMapping("http:someserver/somepath", "http:someserver/somepath");</code></pre> </div> </div> <div class="paragraph"> <p>This is not a recommended approach, but gets you up and running quickly without doing any service name mappings. However, when you have multiple systems across your infrastructure, then you should consider using human-readable service names, that you map to instead of using the camel endpoint uris.</p> </div> </div> </div> <div class="sect1"> <h2 id="camel-zipkin-CustomTags"><a class="anchor" href="#camel-zipkin-CustomTags"></a>Custom Tags</h2> <div class="sectionbody"> <div class="paragraph"> <p>If you need to send custom tags to Zipkin server, add an exchange property with name "camel.client.customtags" and value as a Map of your custom tags. Refrain from adding too many custom tags in production environment.</p> </div> <div class="paragraph"> <p>Following is one example of how custom tags can be added:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Map&lt;String, String&gt; customTags = new HashMap&lt;&gt;();
customTags.put("key1", "value1");
customTags.put("key2", "value2");
exchange.setProperty("camel.client.customtags", customTags);</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="camel-zipkin-camel-zipin-starter"><a class="anchor" href="#camel-zipkin-camel-zipin-starter"></a>camel-zipin-starter</h2> <div class="sectionbody"> <div class="paragraph"> <p>If you are using Spring Boot then you can add the <code>camel-zipkin-starter</code> dependency, and turn on zipkin by annotating the main class with <code>@CamelZipkin</code>. You can then configure camel-zipkin in the <code>application.properties</code> file where you can configure the hostname and port number for the Zipkin Server, and all the other options as listed in the options table above.</p> </div> <div class="paragraph"> <p>You can find an example of this in the <a href="https://github.com/apache/camel/tree/master/examples/camel-example-zipkin">camel-example-zipkin</a></p> </div> </div> </div> </article> </main> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../../_/img/logo-d.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <dl> <dt>Overview</dt> <dd><a href="../../blog/">Blog</a></dd> <dd><a href="../../components/latest/">Components</a></dd> <dd><a href="../../download/">Download</a></dd> <dd><a href="../../docs/getting-started/">Getting started</a></dd> <dd><a href="../../manual/latest/faq.html">FAQ</a></dd> </dl> <dl> <dt>Community</dt> <dd><a href="../../community/support/">Support</a></dd> <dd><a href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a></dd> <dd><a href="../../community/user-stories/">User stories</a></dd> <dd><a href="../../community/articles/">Articles</a></dd> <dd><a href="../../community/books/">Books</a></dd> <dd><a href="../../community/team/">Team</a></dd> </dl> <dl> <dt>About</dt> <dd><a href="../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p> &copy; 2004-2019 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> </div> </footer> <script src="../../_/js/site-f4f4dbc142.js"></script> <script async src="../../_/js/vendor/highlight-54157f17f1.js"></script> <script async src="../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> {
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Apache Camel",
  "url": "https://camel.apache.org",
  "sameAs": [
     "https://twitter.com/ApacheCamel"
  ],
  "logo": "../../_/img/logo-d.svg",
  "description": "Apache Camel â„¢ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL."
} </script> <script type="application/ld+json"> { 
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Apache Camel",
        "item": "https://camel.apache.org"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "Component reference",
        "item": "https://camel.apache.org/components/latest/index.html"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "Zipkin Component","item": "https://camel.apache.org/components/latest/zipkin.html"}
        ]
    } </script> </body> </html> 