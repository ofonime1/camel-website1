<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Eclipse Kura component - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/components/latest/kura.html"> <meta name="generator" content="Antora 2.1.0"> <link rel="stylesheet" href="../../_/css/site-1c739ae396.css"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../.."><span>Apache Camel</span></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item" href="../../blog/">Blog</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Projects</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../projects/camel-k/">Camel K</a> <a class="navbar-item" href="../../projects/camel-quarkus/">Camel Quarkus</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Documentation</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../docs/getting-started/">Getting started</a> <a class="navbar-item" href="../../manual/latest/">User manual</a> <a class="navbar-item" href="../../components/latest/">Component reference</a> <a class="navbar-item" href="../../camel-k/latest/">Camel K</a> <a class="navbar-item" href="../../camel-quarkus/latest/">Camel Quarkus</a> <a class="navbar-item" href="../../manual/latest/enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <a class="navbar-item" href="../../manual/latest/camel-3-migration-guide.html">Camel 3 Migration Guide</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Community</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../community/support/">Support</a> <a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a> <a class="navbar-item" href="../../community/user-stories/">User stories</a> <a class="navbar-item" href="../../community/articles/">Articles</a> <a class="navbar-item" href="../../community/books/">Books</a> <a class="navbar-item" href="../../community/team/">Team</a> </div> </div> <a class="navbar-item" href="../../download/">Download</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">About</a> <div class="navbar-dropdown"> <a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a> <a class="navbar-item" href="https://www.apache.org/licenses/">License</a> <a class="navbar-item" href="../../security/">Security</a> <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div> </div> </div> <div class="navbar-tools"> <a href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#github"/></svg></a> <a href="https://gitter.im/apache/apache-camel" title="Chat on Gitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#gitter"/></svg></a> <a href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <div class="body"> <div class="nav-container" data-component="components" data-version="latest"> <aside class="nav"> <div class="panels"> <div class="nav-panel-explore is-active" data-panel="explore"> <div class="context"> <span class="title">Component reference</span> <span class="version">latest</span> </div> <ul class="components"> <li class="component"> <span class="title">Apache Camel extensions for Quarkus</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-quarkus/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Apache Camel K</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-k/latest/index.html">latest</a> </li> </ul> </li> <li class="component is-current"> <span class="title">Component reference</span> <ul class="versions"> <li class="version is-current is-latest"> <a href="index.html">latest</a> </li> <li class="version"> <a href="../2.x/index.html">2.x</a> </li> </ul> </li> <li class="component"> <span class="title">User manual</span> <ul class="versions"> <li class="version is-latest"> <a href="../../manual/latest/index.html">latest</a> </li> </ul> </li> </ul> </div> </div> </aside> </div> <main role="main"> <div class="toolbar" role="navigation"> <button class="nav-toggle"></button> <a href="../../manual/latest/index.html" class="home-link"></a> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">Component reference</a></li> <li><a href="kura.html">Eclipse Kura component</a></li> </ul> </nav> <div class="page-versions"> <button class="version-menu-toggle" title="Show other versions of page" type="button">latest</button> <div class="version-menu"> <a class="version is-current" href="kura.html">latest</a> <a class="version" href="../2.x/kura.html">2.x</a> </div> </div> <div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/components/camel-kura/src/main/docs/kura.adoc">Edit this Page</a></div> </div> <article class="doc"> <h1 class="page">Eclipse Kura component</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.15</strong></p> </div> <div class="paragraph"> <p>This documentation page covers the integration options of Camel with the <a href="https://eclipse.org/kura/">Eclipse Kura</a> M2M gateway. The common reason to deploy Camel routes into the Eclipse Kura is to provide enterprise integration patterns and Camel components to the messaging M2M gateway. For example you might want to install Kura on Raspberry PI, then read temperature from the sensor attached to that Raspberry PI using Kura services and finally forward the current temperature value to your data center service using Camel EIP and components.</p> </div> </div> </div> <div class="sect1"> <h2 id="Kura-KuraRouteractivator"><a class="anchor" href="#Kura-KuraRouteractivator"></a>KuraRouter activator</h2> <div class="sectionbody"> <div class="paragraph"> <p>Bundles deployed to the Eclipse Kura are usually <a href="http://eclipse.github.io/kura/doc/hello-example.html#create-java-class">developed as bundle activators</a>. So the easiest way to deploy Apache Camel routes into the Kura is to create an OSGi bundle containing the class extending <code>org.apache.camel.kura.KuraRouter</code> class:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

  @Override
  public void configure() throws Exception {
    from("timer:trigger").
      to("netty-http:http://app.mydatacenter.com/api");
  }

}</code></pre> </div> </div> <div class="paragraph"> <p>Keep in mind that <code>KuraRouter</code> implements the <code>org.osgi.framework.BundleActivator</code> interface, so you need to register its <code>start</code> and <code>stop</code> lifecycle methods while <a href="http://eclipse.github.io/kura/doc/hello-example.html#create-component-class">creating Kura bundle component class</a>.</p> </div> <div class="paragraph"> <p>Kura router starts its own OSGi-aware <code>CamelContext</code>. It means that for every class extending <code>KuraRouter</code>, there will be a dedicated <code>CamelContext</code> instance. Ideally we recommend to deploy one <code>KuraRouter</code> per OSGi bundle.</p> </div> <div class="sect2"> <h3 id="Kura-DeployingKuraRouter"><a class="anchor" href="#Kura-DeployingKuraRouter"></a>Deploying KuraRouter</h3> <div class="paragraph"> <p>Bundle containing your Kura router class should import the following packages in the OSGi manifest:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">Import-Package: org.osgi.framework;version="1.3.0",
  org.slf4j;version="1.6.4",
  org.apache.camel,org.apache.camel.impl,org.apache.camel.core.osgi,org.apache.camel.builder,org.apache.camel.model,
  org.apache.camel.component.kura</code></pre> </div> </div> <div class="paragraph"> <p>Keep in mind that you don&#8217;t have to import every Camel component bundle you plan to use in your routes, as Camel components are resolved as the services on the runtime level.</p> </div> <div class="paragraph"> <p>Before you deploy your router bundle, be sure that you have deployed (and started) the following Camel core bundles (using Kura GoGo shell)&#8230;&#8203;</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">install file:///home/user/.m2/repository/org/apache/camel/camel-core/2.15.0/camel-core-2.15.0.jar
start &lt;camel-core-bundle-id&gt;
install file:///home/user/.m2/repository/org/apache/camel/camel-core-osgi/2.15.0/camel-core-osgi-2.15.0.jar
start &lt;camel-core-osgi-bundle-id&gt;
install file:///home/user/.m2/repository/org/apache/camel/camel-kura/2.15.0/camel-kura-2.15.0.jar
start &lt;camel-kura-bundle-id&gt;</code></pre> </div> </div> <div class="paragraph"> <p>&#8230;&#8203;and all the components you plan to use in your routes:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">install file:///home/user/.m2/repository/org/apache/camel/camel-stream/2.15.0/camel-stream-2.15.0.jar
start &lt;camel-stream-bundle-id&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Then finally deploy your router bundle:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">install file:///home/user/.m2/repository/com/example/myrouter/1.0/myrouter-1.0.jar
start &lt;your-bundle-id&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="Kura-KuraRouterutilities"><a class="anchor" href="#Kura-KuraRouterutilities"></a>KuraRouter utilities</h3> <div class="literalblock"> <div class="content"> <pre> Kura router base class provides many useful utilities. This section
explores each of them.</pre> </div> </div> <div class="sect3"> <h4 id="Kura-SLF4Jlogger"><a class="anchor" href="#Kura-SLF4Jlogger"></a>SLF4J logger</h4> <div class="paragraph"> <p>Kura uses SLF4J facade for logging purposes. Protected member <code>log</code> returns SLF4J logger instance associated with the given Kura router.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

    @Override
    public void configure() throws Exception {
        log.info("Configuring Camel routes!");
        ...
    }

}</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="Kura-BundleContext"><a class="anchor" href="#Kura-BundleContext"></a>BundleContext</h4> <div class="paragraph"> <p>Protected member <code>bundleContext</code> returns bundle context associated with the given Kura router.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

    @Override
    public void configure() throws Exception {
        ServiceReference&lt;MyService&gt; serviceRef = bundleContext.getServiceReference(LogService.class.getName());
        MyService myService = bundleContext.getService(serviceRef);
        ...
    }

}</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="Kura-CamelContext"><a class="anchor" href="#Kura-CamelContext"></a>CamelContext</h4> <div class="paragraph"> <p>Protected member <code>camelContext</code> is the <code>CamelContext</code> associated with the given Kura router.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

    @Override
    public void configure() throws Exception {
        camelContext.getStatus();
        ...
    }

}</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="Kura-ProducerTemplate"><a class="anchor" href="#Kura-ProducerTemplate"></a>ProducerTemplate</h4> <div class="paragraph"> <p>Protected member <code>producerTemplate</code> is the <code>ProducerTemplate</code> instance associated with the given Camel context.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

    @Override
    public void configure() throws Exception {
        producerTemplate.sendBody("jms:temperature", 22.0);
        ...
    }

}</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="Kura-ConsumerTemplate"><a class="anchor" href="#Kura-ConsumerTemplate"></a>ConsumerTemplate</h4> <div class="paragraph"> <p>Protected member <code>consumerTemplate</code> is the <code>ConsumerTemplate</code> instance associated with the given Camel context.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

    @Override
    public void configure() throws Exception {
        double currentTemperature = producerTemplate.receiveBody("jms:temperature", Double.class);
        ...
    }

}</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="Kura-OSGiserviceresolver"><a class="anchor" href="#Kura-OSGiserviceresolver"></a>OSGi service resolver</h4> <div class="paragraph"> <p>OSGi service resolver (<code>service(Class&lt;T&gt; serviceType)</code>) can be used to easily retrieve service by type from the OSGi bundle context.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

    @Override
    public void configure() throws Exception {
        MyService myService = service(MyService.class);
        ...
    }

}</code></pre> </div> </div> <div class="paragraph"> <p>If service is not found, a <code>null</code> value is returned. If you want your application to fail if the service is not available, use <code>requiredService(Class)</code> method instead. The <code>requiredService</code> throws <code>IllegalStateException</code> if a service cannot be found.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

    @Override
    public void configure() throws Exception {
        MyService myService = requiredService(MyService.class);
        ...
    }

}</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="Kura-KuraRouteractivatorcallbacks"><a class="anchor" href="#Kura-KuraRouteractivatorcallbacks"></a>KuraRouter activator callbacks</h3> <div class="paragraph"> <p>Kura router comes with the lifecycle callbacks that can be used to customize the way the Camel router works. For example to configure the <code>CamelContext</code> instance associated with the router just before the former is started, override <code>beforeStart</code> method of the <code>KuraRouter</code> class:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyKuraRouter extends KuraRouter {

  ...

  protected void beforeStart(CamelContext camelContext) {
    OsgiDefaultCamelContext osgiContext = (OsgiCamelContext) camelContext;
    osgiContext.setName("NameOfTheRouter");
  }

}</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="Kura-LoadingXMLroutesfromConfigurationAdmin"><a class="anchor" href="#Kura-LoadingXMLroutesfromConfigurationAdmin"></a>Loading XML routes from ConfigurationAdmin</h3> <div class="paragraph"> <p>Sometimes it is desired to read the XML definition of the routes from the server configuration. This a common scenario for IoT gateways where over-the-air redeployment cost may be significant. To address this requirement each <code>KuraRouter</code> looks for the <code>kura.camel.BUNDLE-SYMBOLIC-NAME.route</code> property from the <code>kura.camel</code> PID using the OSGi ConfigurationAdmin. This approach allows you to define Camel XML routes file per deployed <code>KuraRouter</code>. In order to update a route, just edit an appropriate configuration property and restart a bundle associated with it. The content of the <code>kura.camel.BUNDLE-SYMBOLIC-NAME.route</code> property is expected to be Camel XML route file, for example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;routes xmlns="http://camel.apache.org/schema/spring"&gt;
    &lt;route id="loaded"&gt;
        &lt;from uri="direct:bar"/&gt;
        &lt;to uri="mock:bar"/&gt;
    &lt;/route&gt;
&lt;/routes&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="Kura-DeployingKurarouterasadeclarativeOSGiservice"><a class="anchor" href="#Kura-DeployingKurarouterasadeclarativeOSGiservice"></a>Deploying Kura router as a declarative OSGi service</h3> <div class="paragraph"> <p>If you would like to deploy your Kura router as a declarative OSGi service, you can use <code>activate</code> and <code>deactivate</code> methods provided by <code>KuraRouter</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">&lt;scr:component name="org.eclipse.kura.example.camel.MyKuraRouter" activate="activate" deactivate="deactivate" enabled="true" immediate="true"&gt;
  &lt;implementation class="org.eclipse.kura.example.camel.MyKuraRouter"/&gt;
&lt;/scr:component&gt;</code></pre> </div> </div> </div> </div> </div> </article> </main> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../../_/img/logo-d.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <dl> <dt>Overview</dt> <dd><a href="../../blog/">Blog</a></dd> <dd><a href="../../components/latest/">Components</a></dd> <dd><a href="../../download/">Download</a></dd> <dd><a href="../../docs/getting-started/">Getting started</a></dd> <dd><a href="../../manual/latest/faq.html">FAQ</a></dd> </dl> <dl> <dt>Community</dt> <dd><a href="../../community/support/">Support</a></dd> <dd><a href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a></dd> <dd><a href="../../community/user-stories/">User stories</a></dd> <dd><a href="../../community/articles/">Articles</a></dd> <dd><a href="../../community/books/">Books</a></dd> <dd><a href="../../community/team/">Team</a></dd> </dl> <dl> <dt>About</dt> <dd><a href="../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p> &copy; 2004-2019 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> </div> </footer> <script src="../../_/js/site-f4f4dbc142.js"></script> <script async src="../../_/js/vendor/highlight-54157f17f1.js"></script> <script async src="../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> {
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Apache Camel",
  "url": "https://camel.apache.org",
  "sameAs": [
     "https://twitter.com/ApacheCamel"
  ],
  "logo": "../../_/img/logo-d.svg",
  "description": "Apache Camel â„¢ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL."
} </script> <script type="application/ld+json"> { 
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Apache Camel",
        "item": "https://camel.apache.org"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "Component reference",
        "item": "https://camel.apache.org/components/latest/index.html"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "Eclipse Kura component","item": "https://camel.apache.org/components/latest/kura.html"}
        ]
    } </script> </body> </html> 