<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Try it out on OpenShift with Strimzi - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/camel-kafka-connector/latest/try-it-out-on-openshift-with-strimzi.html"> <meta name="generator" content="Antora 2.1.0"> <link rel="stylesheet" href="../../_/css/site-f1efd80cc9.css"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../.."><span>Apache Camel</span></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item" href="../../blog/">Blog</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Projects</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../projects/camel-k/">Camel K</a> <a class="navbar-item" href="../../projects/camel-quarkus/">Camel Quarkus</a> <a class="navbar-item" href="../../projects/camel-kafka-connector/">Camel Kafka Connector</a> <a class="navbar-item" href="../../camel-spring-boot/latest/">Camel Spring Boot</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Documentation</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../manual/latest/getting-started.html">Getting started</a> <a class="navbar-item" href="../../manual/latest/">User manual</a> <a class="navbar-item" href="../../components/latest/">Component reference</a> <a class="navbar-item" href="https://www.javadoc.io/doc/org.apache.camel/camel-api/latest/index.html">API Documentation</a> <a class="navbar-item" href="../../camel-k/latest/">Camel K</a> <a class="navbar-item" href="../../camel-quarkus/latest/">Camel Quarkus</a> <a class="navbar-item" href="../../camel-kafka-connector/latest/">Camel Kafka Connector</a> <a class="navbar-item" href="../../manual/latest/enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <a class="navbar-item" href="../../manual/latest/camel-3-migration-guide.html">Camel 2.x to 3.0 Migration Guide</a> <a class="navbar-item" href="../../manual/latest/camel-3x-upgrade-guide.html">Camel 3.x Upgrade Guide</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Community</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../community/support/">Support</a> <a class="navbar-item" href="../../manual/latest/contributing.html">Contributing</a> <a class="navbar-item" href="../../community/user-stories/">User stories</a> <a class="navbar-item" href="../../community/articles/">Articles</a> <a class="navbar-item" href="../../community/books/">Books</a> <a class="navbar-item" href="../../community/team/">Team</a> </div> </div> <a class="navbar-item" href="../../download/">Download</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">About</a> <div class="navbar-dropdown"> <a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a> <a class="navbar-item" href="https://www.apache.org/licenses/">License</a> <a class="navbar-item" href="../../security/">Security</a> <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div> </div> </div> <div class="navbar-fill"></div> <div class="navbar-search results-hidden"> <input id="search" class="search" placeholder="Search" autocomplete="off"> <div id="search_results"></div> </div> <div class="navbar-tools"> <a href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#github"/></svg></a> <a href="https://gitter.im/apache/apache-camel" title="Chat on Gitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#gitter"/></svg></a> <a href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <div class="body"> <div class="nav-container" data-component="camel-kafka-connector" data-version="latest"> <aside class="nav"> <div class="panels"> <div class="nav-panel-menu is-active" data-panel="menu"> <nav class="nav-menu"> <h3 class="title"><a href="index.html">Apache Camel Kafka Connector</a></h3> <ul class="nav-list"> <li class="nav-item" data-depth="0"> <ul class="nav-list"> <li class="nav-item" data-depth="1"> <a class="nav-link" href="index.html">About</a> </li> <li class="nav-item" data-depth="1"> <a class="nav-link" href="try-it-out-locally.html">Try it out locally</a> </li> <li class="nav-item is-current-page" data-depth="1"> <a class="nav-link" href="try-it-out-on-openshift-with-strimzi.html">Try it out on OpenShift with Strimzi</a> </li> </ul> </li> </ul> </nav> </div> <div class="nav-panel-explore" data-panel="explore"> <div class="context"> <span class="title">Apache Camel Kafka Connector</span> <span class="version">latest</span> </div> <ul class="components"> <li class="component"> <span class="title">Apache Camel extensions for Quarkus</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-quarkus/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Apache Camel K</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-k/latest/index.html">latest</a> </li> </ul> </li> <li class="component is-current"> <span class="title">Apache Camel Kafka Connector</span> <ul class="versions"> <li class="version is-current is-latest"> <a href="index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Camel Spring Boot Starters</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-spring-boot/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Component reference</span> <ul class="versions"> <li class="version is-latest"> <a href="../../components/latest/index.html">latest</a> </li> <li class="version"> <a href="../../components/3.0.x/index.html">3.0.x</a> </li> <li class="version"> <a href="../../components/2.x/index.html">2.x</a> </li> </ul> </li> <li class="component"> <span class="title">User manual</span> <ul class="versions"> <li class="version is-latest"> <a href="../../manual/latest/index.html">latest</a> </li> </ul> </li> </ul> </div> </div> </aside> </div> <main role="main"> <div class="toolbar" role="navigation"> <button class="nav-toggle"></button> <a href="../../manual/latest/index.html" class="home-link"></a> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">Apache Camel Kafka Connector</a></li> <li><a href="try-it-out-on-openshift-with-strimzi.html">Try it out on OpenShift with Strimzi</a></li> </ul> </nav> <div> <label id="toggle-width-label" for="toggle-width">Wide / Narrow</label> </div> <div class="edit-this-page"><a href="https://github.com/apache/camel-kafka-connector/edit/master/docs/modules/ROOT/pages/try-it-out-on-openshift-with-strimzi.adoc">Edit this Page</a></div> </div> <input type="checkbox" id="toggle-width"> <article class="doc"> <h1 class="page">Try it out on OpenShift with Strimzi</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>You can use the Camel Kafka connectors also on Kubernetes and OpenShift with the <a href="https://strimzi.io">Strimzi project</a>. Strimzi provides a set of operators and container images for running Kafka on Kubernetes and OpenShift. The following example shows how to run it with Camel Kafka connectors on OpenShift.</p> </div> </div> </div> <div class="sect1"> <h2 id="_deploy_kafka_and_kafka_connect"><a class="anchor" href="#_deploy_kafka_and_kafka_connect"></a>Deploy Kafka and Kafka Connect</h2> <div class="sectionbody"> <div class="paragraph"> <p>First we install the Strimzi operator and use it to deploy the Kafka broker and Kafka Connect into our OpenShift project. We need to create security objects as part of installation so it is necessary to switch to admin user. If you use Minishift, you can do it with the following command:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc login -u system:admin</code></pre> </div> </div> <div class="paragraph"> <p>We will use OpenShift project <code>myproject</code>. It it doesn&#8217;t exist yet, you can create it using following command:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc new-project myproject</code></pre> </div> </div> <div class="paragraph"> <p>If the project already exists, you can switch to it with:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc project myproject</code></pre> </div> </div> <div class="paragraph"> <p>We can now install the Strimzi operator into this project:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc apply -f https://github.com/strimzi/strimzi-kafka-operator/releases/download/0.13.0/strimzi-cluster-operator-0.13.0.yaml</code></pre> </div> </div> <div class="paragraph"> <p>Next we will deploy a Kafka broker cluster and a Kafka Connect cluster and then create a Kafka Connect image with the Debezium connectors installed:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># Deploy a single node Kafka broker
oc apply -f https://github.com/strimzi/strimzi-kafka-operator/raw/0.13.0/examples/kafka/kafka-persistent-single.yaml

# Deploy a single instance of Kafka Connect with no plug-in installed
oc apply -f https://github.com/strimzi/strimzi-kafka-operator/raw/0.13.0/examples/kafka-connect/kafka-connect-s2i-single-node-kafka.yaml</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_add_camel_kafka_connector_binaries"><a class="anchor" href="#_add_camel_kafka_connector_binaries"></a>Add Camel Kafka connector binaries</h2> <div class="sectionbody"> <div class="paragraph"> <p>Strimzi uses <code>Source2Image</code> builds to allow users to add their own connectors to the existing Strimzi Docker images. We now need to build the connectors and add them to the image:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">mvn clean package
oc start-build my-connect-cluster-connect --from-dir=./core/target/camel-kafka-connector-0.0.1-SNAPSHOT-package/share/java --follow</code></pre> </div> </div> <div class="paragraph"> <p>We should now wait for the rollout of the new image to finish and the replica set with the new connector to become ready. Once it is done, we can check that the <code>CamelSinkConnector</code> and <code>CamelSourceConnector</code> are available in our Kafka Connect cluster. Strimzi is running Kafka Connect in a distributed mode. We can use HTTP to interact with it. To check the available connector plugins, you can run the following command:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc exec -i -c kafka my-cluster-kafka-0 -- curl -s http://my-connect-cluster-connect-api:8083/connector-plugins</code></pre> </div> </div> <div class="paragraph"> <p>You should see something like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-json hljs" data-lang="json">[{"class":"org.apache.camel.kafkaconnector.CamelSinkConnector","type":"sink","version":"0.0.1-SNAPSHOT"},{"class":"org.apache.camel.kafkaconnector.CamelSourceConnector","type":"source","version":"0.0.1-SNAPSHOT"},{"class":"org.apache.kafka.connect.file.FileStreamSinkConnector","type":"sink","version":"2.3.0"},{"class":"org.apache.kafka.connect.file.FileStreamSourceConnector","type":"source","version":"2.3.0"}]</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_create_connector_instance"><a class="anchor" href="#_create_connector_instance"></a>Create connector instance</h2> <div class="sectionbody"> <div class="paragraph"> <p>Now we can create some instance of a connector plugin - got example of the S3 connector:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc exec -i -c kafka my-cluster-kafka-0 -- curl -X POST \
    -H "Accept:application/json" \
    -H "Content-Type:application/json" \
    http://my-connect-cluster-connect-api:8083/connectors -d @- &lt;&lt;'EOF'
{
  "name": "s3-connector",
  "config": {
    "connector.class": "org.apache.camel.kafkaconnector.CamelSourceConnector",
    "tasks.max": "1",
    "key.converter": "org.apache.kafka.connect.storage.StringConverter",
    "value.converter": "org.apache.camel.kafkaconnector.converters.S3ObjectConverter",
    "camel.source.kafka.topic": "s3-topic",
    "camel.source.url": "aws-s3://camel-connector-test?autocloseBody=false",
    "camel.source.maxPollDuration": 10000,
    "camel.component.aws-s3.configuration.access-key": "xxx",
    "camel.component.aws-s3.configuration.secret-key": "xxx",
    "camel.component.aws-s3.configuration.region": "xxx"
  }
}
EOF</code></pre> </div> </div> <div class="paragraph"> <p>You can check the status of the connector using</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc exec -i -c kafka my-cluster-kafka-0 -- curl -s http://my-connect-cluster-connect-api:8083/connectors/s3-connector/status</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_check_received_messages"><a class="anchor" href="#_check_received_messages"></a>Check received messages</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can also run the Kafka console consumer to see the messages received from the topic:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">oc exec -i -c kafka my-cluster-kafka-0 -- bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic s3-topic --from-beginning</code></pre> </div> </div> </div> </div> </article> </main> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../../_/img/logo-d.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <dl> <dt>Overview</dt> <dd><a href="../../blog/">Blog</a></dd> <dd><a href="../../components/latest/">Components</a></dd> <dd><a href="../../download/">Download</a></dd> <dd><a href="../../manual/latest/getting-started.html">Getting started</a></dd> <dd><a href="../../manual/latest/faq.html">FAQ</a></dd> </dl> <dl> <dt>Community</dt> <dd><a href="../../community/support/">Support</a></dd> <dd><a href="../../manual/latest/contributing.html">Contributing</a></dd> <dd><a href="../../community/user-stories/">User stories</a></dd> <dd><a href="../../community/articles/">Articles</a></dd> <dd><a href="../../community/books/">Books</a></dd> <dd><a href="../../community/team/">Team</a></dd> </dl> <dl> <dt>About</dt> <dd><a href="../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p> &copy; 2004-2020 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> </div> </footer> <script src="../../_/js/vendor/alogliasearch-bc4f637dc4.js"></script> <script src="../../_/js/site-f4f4dbc142.js"></script> <script async src="../../_/js/vendor/highlight-54157f17f1.js"></script> <script async src="../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> {
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Apache Camel",
  "url": "https://camel.apache.org",
  "sameAs": [
     "https://twitter.com/ApacheCamel"
  ],
  "logo": "../../_/img/logo-d.svg",
  "description": "Apache Camel â„¢ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL."
} </script> <script type="application/ld+json"> { 
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Apache Camel",
        "item": "https://camel.apache.org"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "Apache Camel Kafka Connector",
        "item": "https://camel.apache.org/camel-kafka-connector/latest/index.html"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "Try it out on OpenShift with Strimzi","item": "https://camel.apache.org/camel-kafka-connector/latest/try-it-out-on-openshift-with-strimzi.html"}
        ]
    } </script> </body> </html> 