<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Aggregate EIP - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/manual/latest/aggregate-eip.html"> <meta name="generator" content="Antora 2.1.0"> <link rel="stylesheet" href="../../_/css/site-7c0d1aca5f.css"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../.."><span>Apache Camel</span></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item" href="../../blog/">Blog</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Projects</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../projects/camel-k/">Camel K</a> <a class="navbar-item" href="../../projects/camel-quarkus/">Camel Quarkus</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Documentation</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../manual/latest/getting-started.html">Getting started</a> <a class="navbar-item" href="../../manual/latest/">User manual</a> <a class="navbar-item" href="../../components/latest/">Component reference</a> <a class="navbar-item" href="../../camel-k/latest/">Camel K</a> <a class="navbar-item" href="../../camel-quarkus/latest/">Camel Quarkus</a> <a class="navbar-item" href="../../manual/latest/enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <a class="navbar-item" href="../../manual/latest/camel-3-migration-guide.html">Camel 3 Migration Guide</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Community</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../community/support/">Support</a> <a class="navbar-item" href="../../manual/latest/contributing.html">Contributing</a> <a class="navbar-item" href="../../community/user-stories/">User stories</a> <a class="navbar-item" href="../../community/articles/">Articles</a> <a class="navbar-item" href="../../community/books/">Books</a> <a class="navbar-item" href="../../community/team/">Team</a> </div> </div> <a class="navbar-item" href="../../download/">Download</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">About</a> <div class="navbar-dropdown"> <a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a> <a class="navbar-item" href="https://www.apache.org/licenses/">License</a> <a class="navbar-item" href="../../security/">Security</a> <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div> </div> </div> <div class="navbar-tools"> <a href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#github"/></svg></a> <a href="https://gitter.im/apache/apache-camel" title="Chat on Gitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#gitter"/></svg></a> <a href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <div class="body"> <div class="nav-container" data-component="manual" data-version="latest"> <aside class="nav"> <div class="panels"> <div class="nav-panel-menu is-active" data-panel="menu"> <nav class="nav-menu"> <h3 class="title"><a href="index.html">User manual</a></h3> <ul class="nav-list"> <li class="nav-item" data-depth="0"> <ul class="nav-list"> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <a class="nav-link" href="getting-started.html">Getting started</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="what-are-the-dependencies.html">What are the dependencies?</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <a class="nav-link" href="architecture.html">Architecture</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="async.html">Async</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="backlogdebugger.html">Backlog debugger</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bam.html">Business Activity Monitoring</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="batch-consumer.html">Batch Consumer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-core.html">Core</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camelcontext.html">Context</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="endpoint.html">Endpoints</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="cep.html">Complex Event Processing</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="component.html">Component</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="debugger.html">Debugger</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="delay-interceptor.html">Delay interceptor</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dependency-injection.html">Dependency Injection</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bean-integration.html">Bean Integration</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bean-binding.html">Bean Binding</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="parameter-binding-annotations.html">Parameter Binding Annotations</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pojo-producing.html">POJO Producing</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pojo-consuming.html">POJO Consuming</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="error-handler.html">Error Handler</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchange.html">Message Exchange</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="using-exchange-pattern-annotations.html">Using Exchange pattern annotations</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="expression.html">Expressions</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="content-enricher.html">Content Enrichment</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="injector.html">Injector</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="intercept.html">Intercept</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="jmx.html">JMX</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="lifecycle.html">Camel Lifecycle</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="oncompletion.html">OnCompletion</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="predicate.html">Predicates</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="registry.html">Registry</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="route-builder.html">RouteBuilder</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="routes.html">Routes</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="transformer.html">Transformer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="validator.html">Validator</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="spring-remoting.html">Spring Remoting</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="hiding-middleware.html">Hidding Middleware</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="health-check.html">Health Checks</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <span class="nav-text">Domain Specific Languages</span> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dsl.html">Camel Domain Specific Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="java-dsl.html">Java DSL</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="spring.html">Spring support</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <span class="nav-text">Supported expression languages</span> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="constant-language.html">Constant Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchangeProperty-language.html">ExchangeProperty Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="file-language.html">File Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="header-language.html">Header Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="properties-component.html">Properties Component</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="ref-language.html">Ref Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="simple-language.html">Simple Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="tokenize-language.html">Tokenize Language</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <a class="nav-link" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <ul class="nav-list"> <li class="nav-item is-current-page" data-depth="2"> <a class="nav-link" href="aggregate-eip.html">Aggregate EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="batch-config-eip.html">Batch-config EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bean-eip.html">Bean EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="choice-eip.html">Choice EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="circuitBreaker-eip.html">CircuitBreaker EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="claimCheck-eip.html">Claim Check EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="content-based-router-eip.html">Content Based Router</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="content-filter-eip.html">Content Filter</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="convertBodyTo-eip.html">Convert Body To EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="customLoadBalancer-eip.html">Custom Load Balancer EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="delay-eip.html">Delay EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dynamic-router.html">Dynamic Router</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dynamicRouter-eip.html">Dynamic Router EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="enrich-eip.html">Enrich EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="eventDrivenConsumer-eip.html">Event Driven Consumer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="failover-eip.html">Failover EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="filter-eip.html">Filter EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="from-eip.html">From EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="hystrix-eip.html">Hystrix EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="hystrixConfiguration-eip.html">Hystrix Configuration EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="idempotentConsumer-eip.html">Idempotent Consumer EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="inOnly-eip.html">In Only EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="inOut-eip.html">In Out EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="loadBalance-eip.html">Load Balance EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="log-eip.html">Log EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="loop-eip.html">Loop EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="marshal-eip.html">Marshal EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="multicast-eip.html">Multicast EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="onFallback-eip.html">On Fallback EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="otherwise-eip.html">Otherwise EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pipeline-eip.html">Pipeline EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pollEnrich-eip.html">Poll Enrich EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="process-eip.html">Process EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="random-eip.html">Random EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="recipientList-eip.html">Recipient List EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="removeHeader-eip.html">Remove Header EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="removeHeaders-eip.html">Remove Headers EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="removeProperties-eip.html">Remove Properties EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="removeProperty-eip.html">Remove Property EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="requestReply-eip.html">Request Reply</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="resequence-eip.html">Resequence EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="resilience4j-eip.html">Resilience4j EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="resilience4jConfiguration-eip.html">Resilience4j Configuration EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="rollback-eip.html">Rollback EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="roundRobin-eip.html">Round Robin EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="routingSlip-eip.html">Routing Slip EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="saga-eip.html">Saga EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="sample-eip.html">Sample EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="script-eip.html">Script EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="serviceCall-eip.html">Service Call EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="setBody-eip.html">Set Body EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="setHeader-eip.html">Set Header EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="setOutHeader-eip.html">Set Out Header EIP (deprecated)</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="setProperty-eip.html">Set Property EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="sort-eip.html">Sort EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="split-eip.html">Split EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="step-eip.html">Step EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="sticky-eip.html">Sticky EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="stop-eip.html">Stop EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="stream-config-eip.html">Stream-config EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="threads-eip.html">Threads EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="throttle-eip.html">Throttle EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="to-eip.html">To EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="toD-eip.html">To D EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="topic-eip.html">Topic EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="transform-eip.html">Transform EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="unmarshal-eip.html">Unmarshal EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="validate-eip.html">Validate EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="weighted-eip.html">Weighted EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="when-eip.html">When EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="wireTap-eip.html">Wire Tap EIP</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <span class="nav-text">Frequently asked questions</span> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/can-i-get-commercial-support.html">Can I get commercial support?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/does-camel-work-on-ibms-jdk.html">Does Camel work on IBM&#8217;s JDK?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="support.html">How can I get help?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-get-the-source-code.html">How can I get the source code?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-compare-to-mule.html">How does Camel compare to Mule?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-compare-to-servicemix.html">How does Camel compare to ServiceMix?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-compare-to-servicemix-eip.html">How does Camel compare to ServiceMix EIP?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-compare-to-synapse.html">How does Camel compare to Synapse?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-work.html">How does Camel work?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-work-with-activemq.html">How does Camel work with ActiveMQ?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-work-with-servicemix.html">How does Camel work with ServiceMix?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-the-camel-api-compare-to.html">How does the Camel API compare to?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-the-website-work.html">How does the website work?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-become-a-committer.html">How do I become a committer?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-compile-the-code.html">How do I compile the code?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-edit-the-website.html">How do I edit the website?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-run-camel-using-java-webstart.html">How do I run Camel using Java WebStart?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/if-i-use-servicemix-when-should-i-use-camel.html">If I use ServiceMix when should I use Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/is-camel-an-esb.html">Is Camel an ESB?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/is-camel-ioc-friendly.html">Is Camel IoC friendly?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/running-camel-standalone.html">Running Camel standalone</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-are-the-dependencies.html">What are the dependencies?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-a-router.html">What is a router?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-camel.html">What is Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-the-license.html">What is the license?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-jars-do-i-need.html">What jars do I need?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="languages.html">What languages are supported?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-platforms-are-supported.html">What platforms are supported?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-the-name-camel.html">Why the name Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/classloader-issue-of-servicemix-camel-component.html">Classloader issue of servicemix-camel component</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-specify-which-method-to-use-when-using-beans-in-routes.html">How do I specify which method to use when using beans in routes?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-create-a-custom-component-or-endpoint.html">How can I create a custom component or endpoint?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-get-the-remote-connection-ip-address-from-the-camel-cxf-consumer-.html">How can I get the remote connection IP address from the camel-cxf consumer ?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-stop-a-route-from-a-route.html">How can I stop a route from a route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-webservice-clients-see-remote-faults-with-stacktraces-when-using-camel-cxf.html">How can webservice clients see remote faults with stacktraces when using camel-cxf?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-look-up-beans-and-endpoints.html">How does Camel look up beans and endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="configuring-camel.html">How do I add a component?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-change-the-logging.html">How do I change the logging?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-endpoints.html">How do I configure endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-password-options-on-camel-endpoints-without-the-value-being-encoded.html">How do I configure password options on Camel endpoints without the value being encoded?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-the-default-maximum-cache-size-for-producercache-or-producertemplate.html">How do I configure the default maximum cache size for ProducerCache or ProducerTemplate?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-the-maximum-endpoint-cache-size-for-camelcontext.html">How do I configure the maximum endpoint cache size for CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-debug-my-route.html">How do I debug my route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-disable-jmx.html">How do I disable JMX?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-enable-streams-when-debug-logging-messages-in-camel.html">How do I enable streams when debug logging messages in Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-handle-failures-when-consuming-for-example-from-a-ftp-server.html">How do I handle failures when consuming for example from a FTP server?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-import-rests-from-other-xml-files.html">How do I import rests from other XML files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-import-routes-from-other-xml-files.html">How do I import routes from other XML files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-let-jetty-match-wildcards.html">How do I let Jetty match wildcards?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-name-my-routes.html">How do I name my routes?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-restart-camelcontext.html">How do I restart CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retrieve-the-thrown-exception-during-processing-an-exchange.html">How do I retrieve the thrown Exception during processing an Exchange?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retry-failed-messages-forever.html">How do I retry failed messages forever?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retry-processing-a-message-from-a-certain-point-back-or-an-entire-route.html">How do I retry processing a message from a certain point back or an entire route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-reuse-the-contexttestsupport-class-in-my-unit-tests.html">How do I reuse the ContextTestSupport class in my unit tests?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-run-activemq-and-camel-in-jboss.html">How do I run ActiveMQ and Camel in JBoss?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-set-the-max-chars-when-debug-logging-messages-in-camel.html">How do I set the max chars when debug logging messages in Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-specify-time-period-in-a-human-friendly-syntax.html">How do I specify time period in a human friendly syntax?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-a-big-uber-jar.html">How do I use a big (uber) JAR?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-camel-inside-servicemix.html">How do I use Camel inside ServiceMix?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-spring-property-placeholder-with-camel-xml.html">How do I use Spring Property Placeholder with Camel XML?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-uris-with-parameters-in-xml.html">How do I use URIs with parameters in XML?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-write-a-custom-processor-which-sends-multiple-messages.html">How do I write a custom Processor which sends multiple messages?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-should-i-invoke-my-pojos-or-spring-services.html">How should I invoke my POJOs or Spring Services?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-should-i-package-applications-using-camel-and-activemq.html">How should I package applications using Camel and ActiveMQ?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-avoid-importing-bunch-of-cxf-packages-when-start-up-the-camel-cxf-endpoint-from-osgi-platform-.html">How to avoid importing bunch of cxf packages when start up the camel-cxf endpoint from OSGi platform?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-avoid-sending-some-or-all-message-headers.html">How to avoid sending some or all message headers?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-define-a-static-camel-converter-method-in-scala.html">How to define a static Camel converter method in Scala?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-remove-the-http-protocol-headers-in-the-camel-message.html">How to remove the http protocol headers in the camel message?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-send-the-same-message-to-multiple-endpoints.html">How to send the same message to multiple endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-switch-the-cxf-consumer-between-http-and-https-without-touching-the-spring-configuration.html">How to switch the CXF consumer between HTTP and HTTPS without touching the Spring configuration?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-use-a-dynamic-uri-in-to.html">How to use a dynamic URI in to()?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/is-there-an-ide.html">Is there an IDE?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/should-i-deploy-camel-inside-the-activemq-broker-or-in-another-application.html">Should I deploy Camel inside the ActiveMQ broker or in another application?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/using-camel-core-testsjar.html">Using camel-core-tests.jar</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/using-getin-or-getout-methods-on-exchange.html">Using getIn or getOut methods on Exchange</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-cant-i-use-sign-in-my-password.html">Why can&#8217;t I use + sign in my password?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-can-i-not-use-when-or-otherwise-in-a-java-camel-route.html">Why can I not use when or otherwise in a Java Camel route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-ftp-component-not-download-any-files.html">Why does FTP component not download any files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-my-file-consumer-not-pick-up-the-file-and-how-do-i-let-the-file-consumer-use-the-camel-error-handler.html">Why does my file consumer not pick up the file, and how do I let the file consumer use the Camel error handler?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-useoriginalmessage-with-error-handler-not-work-as-expected.html">Why does useOriginalMessage with error handler not work as expected?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-do-my-message-lose-its-headers-during-routing.html">Why do my message lose its headers during routing?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-my-message-body-empty.html">Why is my message body empty?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-my-processor-not-showing-up-in-jconsole.html">Why is my processor not showing up in JConsole?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-the-exception-null-when-i-use-onexception.html">Why is the exception null when I use onException?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-use-multiple-camelcontext.html">Why use multiple CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-enable-debug-logging.html">How do I enable debug logging?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-java-14-logging.html">How do I use Java 1.4 logging?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-log4j.html">How do I use log4j?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-invoke-camel-routes-from-jbi.html">How do I invoke Camel routes from JBI?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-make-my-jms-endpoint-transactional.html">How Do I Make My JMS Endpoint Transactional?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-set-the-mep-when-interacting-with-jbi.html">How do I set the MEP when interacting with JBI?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-the-direct-event-seda-and-vm-endpoints-compare.html">How do the direct, event, seda and vm endpoints compare?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-the-timer-and-quartz-endpoints-compare.html">How do the Timer and Quartz endpoints compare?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-my-jms-route-only-consume-one-message-at-once.html">Why does my JMS route only consume one message at once?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-beandefinitionstoreexception.html">Exception - BeanDefinitionStoreException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-javaxnamingnoinitialcontextexception.html">Exception - javax.naming.NoInitialContextException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-orgapachecamelnosuchendpointexception.html">Exception - org.apache.camel.NoSuchEndpointException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-orgxmlsaxsaxparseexception.html">Exception - org.xml.sax.SAXParseException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/memory-leak-when-adding-and-removing-routes-at-runtime.html">Memory leak when adding and removing routes at runtime</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-do-camel-throw-so-many-noclassdeffoundexception-on-startup.html">Why do Camel throw so many NoClassDefFoundException on startup?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-camel-use-too-many-threads-with-producertemplate.html">Why does Camel use too many threads with ProducerTemplate?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-maven-not-download-dependencies.html">Why does maven not download dependencies?</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <a class="nav-link" href="camel-3-migration-guide.html">Camel 3 Migration Guide</a> </li> </ul> </li> </ul> </nav> </div> <div class="nav-panel-explore" data-panel="explore"> <div class="context"> <span class="title">User manual</span> <span class="version">latest</span> </div> <ul class="components"> <li class="component"> <span class="title">Apache Camel extensions for Quarkus</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-quarkus/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Apache Camel K</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-k/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Component reference</span> <ul class="versions"> <li class="version is-latest"> <a href="../../components/latest/index.html">latest</a> </li> <li class="version"> <a href="../../components/3.0.x/index.html">3.0.x</a> </li> <li class="version"> <a href="../../components/2.x/index.html">2.x</a> </li> </ul> </li> <li class="component is-current"> <span class="title">User manual</span> <ul class="versions"> <li class="version is-current is-latest"> <a href="index.html">latest</a> </li> </ul> </li> </ul> </div> </div> </aside> </div> <main role="main"> <div class="toolbar" role="navigation"> <button class="nav-toggle"></button> <a href="index.html" class="home-link"></a> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">User manual</a></li> <li><a href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a></li> <li><a href="aggregate-eip.html">Aggregate EIP</a></li> </ul> </nav> <div> <label id="toggle-width-label" for="toggle-width">Wide / Narrow</label> </div> <div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/core/camel-core-engine/src/main/docs/eips/aggregate-eip.adoc">Edit this Page</a></div> </div> <input type="checkbox" id="toggle-width"> <article class="doc"> <h1 class="page">Aggregate EIP</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>The <a href="http://www.enterpriseintegrationpatterns.com/Aggregator.html">Aggregator</a> from the <a href="enterprise-integration-patterns.html" class="page">EIP patterns</a> allows you to combine a number of messages together into a single message.</p> </div> <div class="imageblock"> <div class="content"> <img src="_images/eip/Aggregator.gif" alt="image"> </div> </div> <div class="paragraph"> <p>A correlation <a href="expression.html" class="page">Expression</a> is used to determine the messages which should be aggregated together. If you want to aggregate all messages into a single message, just use a constant expression. An AggregationStrategy is used to combine all the message exchanges for a single correlation key into a single message exchange.</p> </div> </div> </div> <div class="sect1"> <h2 id="_aggregator_options"><a class="anchor" href="#_aggregator_options"></a>Aggregator options</h2> <div class="sectionbody"> <div class="paragraph"> <p>The Aggregate EIP supports 27 options which are listed below:</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-center valign-top">Default</th> <th class="tableblock halign-left valign-top">Type</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>correlationExpression</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong> The expression used to calculate the correlation key to use for aggregation. The Exchange which has the same correlation key is aggregated together. If the correlation key could not be evaluated an Exception is thrown. You can disable this by using the ignoreBadCorrelationKeys option.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">NamespaceAware Expression</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionPredicate</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A Predicate to indicate when an aggregated exchange is complete. If this is not specified and the AggregationStrategy object implements Predicate, the aggregationStrategy object will be used as the completionPredicate.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">NamespaceAware Expression</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionTimeoutExpression</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Time in millis that an aggregated exchange should be inactive before its complete (timeout). This option can be set as either a fixed value or using an Expression which allows you to evaluate a timeout dynamically - will use Long as result. If both are set Camel will fallback to use the fixed value if the Expression result was null or 0. You cannot use this option together with completionInterval, only one of the two can be used. By default the timeout checker runs every second, you can use the completionTimeoutCheckerInterval option to configure how frequently to run the checker. The timeout is an approximation and there is no guarantee that the a timeout is triggered exactly after the timeout value. It is not recommended to use very low timeout values or checker intervals.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">NamespaceAware Expression</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionSizeExpression</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of messages aggregated before the aggregation is complete. This option can be set as either a fixed value or using an Expression which allows you to evaluate a size dynamically - will use Integer as result. If both are set Camel will fallback to use the fixed value if the Expression result was null or 0.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">NamespaceAware Expression</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>optimisticLockRetryPolicy</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Allows to configure retry settings when using optimistic locking.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">OptimisticLockRetry PolicyDefinition</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>parallelProcessing</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">When aggregated are completed they are being send out of the aggregator. This option indicates whether or not Camel should use a thread pool with multiple threads for concurrency. If no custom thread pool has been specified then Camel creates a default pool with 10 concurrent threads.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>optimisticLocking</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Turns on using optimistic locking, which requires the aggregationRepository being used, is supporting this by implementing org.apache.camel.spi.OptimisticLockingAggregationRepository.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>executorServiceRef</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If using parallelProcessing you can specify a custom thread pool to be used. In fact also if you are not using parallelProcessing this custom thread pool is used to send out aggregated exchanges as well.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>timeoutCheckerExecutor ServiceRef</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If using either of the completionTimeout, completionTimeoutExpression, or completionInterval options a background thread is created to check for the completion for every aggregator. Set this option to provide a custom thread pool to be used rather than creating a new thread for every aggregator.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>aggregationRepositoryRef</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Sets the custom aggregate repository to use Will by default use org.apache.camel.processor.aggregate.MemoryAggregationRepository</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>strategyRef</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A reference to lookup the AggregationStrategy in the Registry. Configuring an AggregationStrategy is required, and is used to merge the incoming Exchange with the existing already merged exchanges. At first call the oldExchange parameter is null. On subsequent invocations the oldExchange contains the merged exchanges and newExchange is of course the new incoming Exchange.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>strategyMethodName</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This option can be used to explicit declare the method name to use, when using POJOs as the AggregationStrategy.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>strategyMethodAllowNull</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If this option is false then the aggregate method is not used for the very first aggregation. If this option is true then null values is used as the oldExchange (at the very first aggregation), when using POJOs as the AggregationStrategy.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionSize</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of messages aggregated before the aggregation is complete. This option can be set as either a fixed value or using an Expression which allows you to evaluate a size dynamically - will use Integer as result. If both are set Camel will fallback to use the fixed value if the Expression result was null or 0.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionInterval</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A repeating period in millis by which the aggregator will complete all current aggregated exchanges. Camel has a background task which is triggered every period. You cannot use this option together with completionTimeout, only one of them can be used.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionTimeout</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Time in millis that an aggregated exchange should be inactive before its complete (timeout). This option can be set as either a fixed value or using an Expression which allows you to evaluate a timeout dynamically - will use Long as result. If both are set Camel will fallback to use the fixed value if the Expression result was null or 0. You cannot use this option together with completionInterval, only one of the two can be used. By default the timeout checker runs every second, you can use the completionTimeoutCheckerInterval option to configure how frequently to run the checker. The timeout is an approximation and there is no guarantee that the a timeout is triggered exactly after the timeout value. It is not recommended to use very low timeout values or checker intervals.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionTimeoutChecker Interval</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Interval in millis that is used by the background task that checks for timeouts (org.apache.camel.TimeoutMap). By default the timeout checker runs every second. The timeout is an approximation and there is no guarantee that the a timeout is triggered exactly after the timeout value. It is not recommended to use very low timeout values or checker intervals.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionFromBatchConsumer</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Enables the batch completion mode where we aggregate from a org.apache.camel.BatchConsumer and aggregate the total number of exchanges the org.apache.camel.BatchConsumer has reported as total by checking the exchange property org.apache.camel.Exchange#BATCH_COMPLETE when its complete. This option cannot be used together with discardOnAggregationFailure.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completionOnNewCorrelation Group</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Enables completion on all previous groups when a new incoming correlation group. This can for example be used to complete groups with same correlation keys when they are in consecutive order. Notice when this is enabled then only 1 correlation group can be in progress as when a new correlation group starts, then the previous groups is forced completed.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>eagerCheckCompletion</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Use eager completion checking which means that the completionPredicate will use the incoming Exchange. As opposed to without eager completion checking the completionPredicate will use the aggregated Exchange.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ignoreInvalidCorrelation Keys</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If a correlation key cannot be successfully evaluated it will be ignored by logging a DEBUG and then just ignore the incoming Exchange.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>closeCorrelationKeyOn Completion</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Closes a correlation key when its complete. Any late received exchanges which has a correlation key that has been closed, it will be defined and a ClosedCorrelationKeyException is thrown.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>discardOnCompletionTimeout</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Discards the aggregated message on completion timeout. This means on timeout the aggregated message is dropped and not sent out of the aggregator.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>discardOnAggregationFailure</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Discards the aggregated message when aggregation failed (an exception was thrown from AggregationStrategy. This means the partly aggregated message is dropped and not sent out of the aggregator. This option cannot be used together with completionFromBatchConsumer.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>forceCompletionOnStop</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indicates to complete all current aggregated exchanges when the context is stopped</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>completeAllOnStop</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indicates to wait to complete all current and partial (pending) aggregated exchanges when the context is stopped. This also means that we will wait for all pending exchanges which are stored in the aggregation repository to complete so the repository is empty before we can stop. You may want to enable this when using the memory based aggregation repository that is memory based only, and do not store data on disk. When this option is enabled, then the aggregator is waiting to complete all those exchanges before its stopped, when stopping CamelContext or the route using it.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><strong>aggregateControllerRef</strong></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">To use a org.apache.camel.processor.aggregate.AggregateController to allow external sources to control this aggregator.</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td> </tr> </tbody> </table></div> </div> </div> <div class="sect1"> <h2 id="_about_aggregationstrategy"><a class="anchor" href="#_about_aggregationstrategy"></a>About AggregationStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <code>AggregationStrategy</code> is used for aggregating the old (lookup by its correlation id) and the new exchanges together into a single exchange. Possible implementations include performing some kind of combining or delta processing, such as adding line items together into an invoice or just using the newest exchange and removing old exchanges such as for state tracking or market data prices; where old values are of little use.</p> </div> <div class="paragraph"> <p>Notice the aggregation strategy is a mandatory option and must be provided to the aggregator.</p> </div> <div class="admonitionblock important"> <div class="table-wrapper"><table> <tr> <td class="icon"> <i class="fa icon-important" title="Important"></i> </td> <td class="content"> In the aggregate method, do not create a new exchange instance to return, instead return either the old or new exchange from the input parameters; favor returning the old exchange whenever possible. </td> </tr> </table></div> </div> <div class="paragraph"> <p>Here are a few example <code>AggregationStrategy</code> implementations that should help you create your own custom strategy.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">//simply combines Exchange String body values using '+' as a delimiter
class StringAggregationStrategy implements AggregationStrategy {

    public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {
        if (oldExchange == null) {
            return newExchange;
        }

        String oldBody = oldExchange.getIn().getBody(String.class);
        String newBody = newExchange.getIn().getBody(String.class);
        oldExchange.getIn().setBody(oldBody + "+" + newBody);
        return oldExchange;
    }
}

//simply combines Exchange body values into an ArrayList&lt;Object&gt;
class ArrayListAggregationStrategy implements AggregationStrategy {

    public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {
        Object newBody = newExchange.getIn().getBody();
        ArrayList&lt;Object&gt; list = null;
        if (oldExchange == null) {
            list = new ArrayList&lt;Object&gt;();
            list.add(newBody);
            newExchange.getIn().setBody(list);
            return newExchange;
        } else {
            list = oldExchange.getIn().getBody(ArrayList.class);
            list.add(newBody);
            return oldExchange;
        }
    }
}</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_about_completion"><a class="anchor" href="#_about_completion"></a>About completion</h2> <div class="sectionbody"> <div class="paragraph"> <p>When aggregation <a href="exchange.html" class="page">Exchange</a>s at some point you need to indicate that the aggregated exchanges is complete, so they can be send out of the aggregator. Camel allows you to indicate completion in various ways as follows:</p> </div> <div class="ulist"> <ul> <li> <p>completionTimeout - Is an inactivity timeout in which is triggered if no new exchanges have been aggregated for that particular correlation key within the period.</p> </li> <li> <p>completionInterval - Once every X period all the current aggregated exchanges are completed.</p> </li> <li> <p>completionSize - Is a number indicating that after X aggregated exchanges it&#8217;s complete.</p> </li> <li> <p>completionPredicate - Runs a <a href="predicate.html" class="page">Predicate</a> when a new exchange is aggregated to determine if we are complete or not. The configured aggregationStrategy can implement the Predicate interface and will be used as the completionPredicate if no completionPredicate is configured. The configured aggregationStrategy can implement <code>PreCompletionAwareAggregationStrategy</code> and will be used as the completionPredicate in pre-complete check mode. See further below for more details.</p> </li> <li> <p>completionFromBatchConsumer - Special option for <a href="batch-consumer.html" class="page">Batch Consumer</a> which allows you to complete when all the messages from the batch has been aggregated.</p> </li> <li> <p>forceCompletionOnStop - Indicates to complete all current aggregated exchanges when the context is stopped</p> </li> <li> <p>Using a <code>AggregateController</code> - which allows to use an external source to complete groups or all groups. This can be done using Java or JMX API.</p> </li> </ul> </div> <div class="paragraph"> <p>Notice that all the completion ways are per correlation key. And you can combine them in any way you like. It&#8217;s basically the first which triggers that wins. So you can use a completion size together with a completion timeout. Only completionTimeout and completionInterval cannot be used at the same time.</p> </div> <div class="paragraph"> <p>Notice the completion is a mandatory option and must be provided to the aggregator. If not provided Camel will thrown an Exception on startup.</p> </div> </div> </div> <div class="sect1"> <h2 id="_pre_completion_mode"><a class="anchor" href="#_pre_completion_mode"></a>Pre-completion mode</h2> <div class="sectionbody"> <div class="paragraph"> <p>There can be use-cases where you want the incoming <a href="exchange.html" class="page">Exchange</a> to determine if the correlation group should pre-complete, and then the incoming <a href="exchange.html" class="page">Exchange</a> is starting a new group from scratch. To determine this the <code>AggregationStrategy</code> can implement <code>PreCompletionAwareAggregationStrategy</code> which has a <code>preComplete</code> method:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    /**
     * Determines if the aggregation should complete the current group, and start a new group, or the aggregation
     * should continue using the current group.
     *
     * @param oldExchange the oldest exchange (is &lt;tt&gt;null&lt;/tt&gt; on first aggregation as we only have the new exchange)
     * @param newExchange the newest exchange (can be &lt;tt&gt;null&lt;/tt&gt; if there was no data possible to acquire)
     * @return &lt;tt&gt;true&lt;/tt&gt; to complete current group and start a new group, or &lt;tt&gt;false&lt;/tt&gt; to keep using current
     */
    boolean preComplete(Exchange oldExchange, Exchange newExchange);</code></pre> </div> </div> <div class="paragraph"> <p>If the preComplete method returns true, then the existing groups is completed (without aggregating the incoming exchange (newExchange). And then the newExchange is used to start the correlation group from scratch so the group would contain only that new incoming exchange. This is known as pre-completion mode. And when the aggregation is in pre-completion mode, then only the following completions are in use</p> </div> <div class="ulist"> <ul> <li> <p>aggregationStrategy must implement <code>PreCompletionAwareAggregationStrategy</code> xxx</p> </li> <li> <p>completionTimeout or completionInterval can also be used as fallback completions</p> </li> <li> <p>any other completion are not used (such as by size, from batch consumer etc)</p> </li> <li> <p>eagerCheckCompletion is implied as true, but the option has no effect</p> </li> </ul> </div> </div> </div> <div class="sect1"> <h2 id="_persistent_aggregationrepository"><a class="anchor" href="#_persistent_aggregationrepository"></a>Persistent AggregationRepository</h2> <div class="sectionbody"> <div class="paragraph"> <p>The aggregator provides a pluggable repository which you can implement your own <code>org.apache.camel.spi.AggregationRepository</code>.<br> If you need persistent repository then you can use either Camel <a href="../../components/latest/leveldb.html" class="page">LevelDB</a>, or <a href="../../components/latest/sql-component.html" class="page">SQL Component</a> components.</p> </div> </div> </div> <div class="sect1"> <h2 id="_using_timeoutawareaggregationstrategy"><a class="anchor" href="#_using_timeoutawareaggregationstrategy"></a>Using TimeoutAwareAggregationStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>If your aggregation strategy implements <code>TimeoutAwareAggregationStrategy</code>, then Camel will invoke the <code>timeout</code> method when the timeout occurs. Notice that the values for index and total parameters will be -1, and the timeout parameter will be provided only if configured as a fixed value. You must <strong>not</strong> throw any exceptions from the <code>timeout</code> method.</p> </div> </div> </div> <div class="sect1"> <h2 id="_using_completionawareaggregationstrategy"><a class="anchor" href="#_using_completionawareaggregationstrategy"></a>Using CompletionAwareAggregationStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>If your aggregation strategy implements <code>CompletionAwareAggregationStrategy</code>, then Camel will invoke the <code>onComplete</code> method when the aggregated Exchange is completed. This allows you to do any last minute custom logic such as to cleanup some resources, or additional work on the exchange as it&#8217;s now completed.<br> You must <strong>not</strong> throw any exceptions from the <code>onCompletion</code> method.</p> </div> </div> </div> <div class="sect1"> <h2 id="_completing_current_group_decided_from_the_aggregationstrategy"><a class="anchor" href="#_completing_current_group_decided_from_the_aggregationstrategy"></a>Completing current group decided from the AggregationStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <code>AggregationStrategy</code> can now included a property on the returned <code>Exchange</code> that contains a boolean to indicate if the current group should be completed. This allows to overrule any existing completion predicates / sizes / timeouts etc, and complete the group.</p> </div> <div class="paragraph"> <p>For example the following logic (from an unit test) will complete the group if the message body size is larger than 5. This is done by setting the property <code>Exchange.AGGREGATION_COMPLETE_CURRENT_GROUP</code> to <code>true</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    public final class MyCompletionStrategy implements AggregationStrategy {
        @Override
        public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {
            if (oldExchange == null) {
                return newExchange;
            }
            String body = oldExchange.getIn().getBody(String.class) + "+"
                + newExchange.getIn().getBody(String.class);
            oldExchange.getIn().setBody(body);
            if (body.length() &gt;= 5) {
                oldExchange.setProperty(Exchange.AGGREGATION_COMPLETE_CURRENT_GROUP, true);
            }
            return oldExchange;
        }
    }</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_completing_all_previous_group_decided_from_the_aggregationstrategy"><a class="anchor" href="#_completing_all_previous_group_decided_from_the_aggregationstrategy"></a>Completing all previous group decided from the AggregationStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <code>AggregationStrategy</code> can now included a property on the returned <code>Exchange</code> that contains a boolean to indicate if all previous groups should be completed. This allows to overrule any existing completion predicates / sizes / timeouts etc, and complete all the existing previous group.</p> </div> <div class="paragraph"> <p>For example the following logic (from an unit test) will complete all the previous group when a new aggregation group is started. This is done by setting the property <code>Exchange.AGGREGATION_COMPLETE_ALL_GROUPS</code> to <code>true</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    public final class MyCompletionStrategy implements AggregationStrategy {
        @Override
        public Exchange aggregate(Exchange oldExchange, Exchange newExchange) {
            if (oldExchange == null) {
                // we start a new correlation group, so complete all previous groups
                newExchange.setProperty(Exchange.AGGREGATION_COMPLETE_ALL_GROUPS, true);
                return newExchange;
            }

            String body1 = oldExchange.getIn().getBody(String.class);
            String body2 = newExchange.getIn().getBody(String.class);

            oldExchange.getIn().setBody(body1 + body2);
            return oldExchange;
        }
    }</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_manually_force_the_completion_of_all_aggregated_exchanges_immediately"><a class="anchor" href="#_manually_force_the_completion_of_all_aggregated_exchanges_immediately"></a>Manually Force the Completion of All Aggregated Exchanges Immediately</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can manually trigger completion of all current aggregated exchanges by sending a message containing the header <code>Exchange.AGGREGATION_COMPLETE_ALL_GROUPS</code> set to <code>true</code>. The message is considered a signal message only, the message headers/contents will not be processed otherwise.</p> </div> <div class="paragraph"> <p>You can alternatively set the header <code>Exchange.AGGREGATION_COMPLETE_ALL_GROUPS_INCLUSIVE</code> to <code>true</code> to trigger completion of all groups after processing the current message.</p> </div> </div> </div> <div class="sect1"> <h2 id="_using_a_listv_in_aggregationstrategy"><a class="anchor" href="#_using_a_listv_in_aggregationstrategy"></a>Using a List&lt;V&gt; in AggregationStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>If you want to aggregate some value from the messages <code>&lt;V&gt;</code> into a <code>List&lt;V&gt;</code> then we have added a <code>org.apache.camel.processor.aggregate.AbstractListAggregationStrategy</code> abstract class that makes this easier. The completed Exchange that is sent out of the aggregator will contain the <code>List&lt;V&gt;</code> in the message body.</p> </div> <div class="paragraph"> <p>For example to aggregate a <code>List&lt;Integer&gt;</code> you can extend this class as shown below, and implement the <code>getValue</code> method:</p> </div> </div> </div> <div class="sect1"> <h2 id="_using_aggregatecontroller"><a class="anchor" href="#_using_aggregatecontroller"></a>Using AggregateController</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <code>org.apache.camel.processor.aggregate.AggregateController</code> allows you to control the aggregate at runtime using Java or JMX API. This can be used to force completing groups of exchanges, or query its current runtime statistics.</p> </div> <div class="paragraph"> <p>The aggregator provides a default implementation if no custom have been configured, which can be accessed using <code>getAggregateController()</code> method. Though it may be easier to configure a controller in the route using <code>aggregateController</code> as shown below:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private AggregateController controller = new DefaultAggregateController();

from("direct:start")
   .aggregate(header("id"), new MyAggregationStrategy())
      .completionSize(10).id("myAggregator")
      .aggregateController(controller)
      .to("mock:aggregated");</code></pre> </div> </div> <div class="paragraph"> <p>Then there is API on AggregateController to force completion. For example to complete a group with key foo</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">int groups = controller.forceCompletionOfGroup("foo");</code></pre> </div> </div> <div class="paragraph"> <p>The number return would be the number of groups completed. In this case it would be 1 if the foo group existed and was completed. If foo does not exists then 0 is returned.</p> </div> <div class="paragraph"> <p>There is also an api to complete all groups</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">int groups = controller.forceCompletionOfAllGroups();</code></pre> </div> </div> <div class="paragraph"> <p>To configure this from XML DSL</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="myController" class="org.apache.camel.processor.aggregate.DefaultAggregateController"/&gt;

  &lt;camelContext xmlns="http://camel.apache.org/schema/spring"&gt;
        &lt;route&gt;
            &lt;from uri="direct:start"/&gt;
            &lt;aggregate strategyRef="myAppender" completionSize="10"
                       aggregateControllerRef="myController"&gt;
                &lt;correlationExpression&gt;
                    &lt;header&gt;id&lt;/header&gt;
                &lt;/correlationExpression&gt;
                &lt;to uri="mock:result"/&gt;
            &lt;/aggregate&gt;
        &lt;/route&gt;
    &lt;/camelContext&gt;</code></pre> </div> </div> <div class="paragraph"> <p>There is also JMX API on the aggregator which is available under the processors node in the Camel JMX tree.</p> </div> </div> </div> <div class="sect1"> <h2 id="_using_groupedexchanges"><a class="anchor" href="#_using_groupedexchanges"></a>Using GroupedExchanges</h2> <div class="sectionbody"> <div class="paragraph"> <p>In the route below we group all the exchanges together using <code>groupExchanges()</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:start")
    // aggregate all using same expression
    .aggregate(constant(true))
    // wait for 0.5 seconds to aggregate
    .completionTimeout(500L)
    // group the exchanges so we get one single exchange containing all the others
    .groupExchanges()
    .to("mock:result");</code></pre> </div> </div> <div class="paragraph"> <p>As a result we have one outgoing <code>Exchange</code> being routed the <code>"mock:result"</code> endpoint. The exchange is a holder containing all the incoming Exchanges.</p> </div> <div class="paragraph"> <p>The output of the aggregator will then contain the exchanges grouped together in a list as shown below:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Exchange&gt; grouped = exchange.getIn().getBody(List.class);</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_using_pojos_as_aggregationstrategy"><a class="anchor" href="#_using_pojos_as_aggregationstrategy"></a>Using POJOs as AggregationStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>To use the <code>AggregationStrategy</code> you had to implement the <code>org.apache.camel.AggregationStrategy</code> interface, which means your logic would be tied to the Camel API. You can use a POJO for the logic and let Camel adapt to your POJO. To use a POJO a convention must be followed:</p> </div> <div class="ulist"> <ul> <li> <p>there must be a public method to use</p> </li> <li> <p>the method must not be void</p> </li> <li> <p>the method can be static or non-static</p> </li> <li> <p>the method must have 2 or more parameters</p> </li> <li> <p>the parameters is paired so the first 50% is applied to the <code>oldExchange</code> and the reminder 50% is for the <code>newExchange</code></p> </li> <li> <p>.. meaning that there must be an equal number of parameters, eg 2, 4, 6 etc.</p> </li> </ul> </div> <div class="paragraph"> <p>The paired methods is expected to be ordered as follows:</p> </div> <div class="ulist"> <ul> <li> <p>the first parameter is the message body</p> </li> <li> <p>the 2nd parameter is a Map of the headers</p> </li> <li> <p>the 3rd parameter is a Map of the Exchange properties</p> </li> </ul> </div> <div class="paragraph"> <p>This convention is best explained with some examples.</p> </div> <div class="paragraph"> <p>In the method below, we have only 2 parameters, so the 1st parameter is the body of the <code>oldExchange</code>, and the 2nd is paired to the body of the <code>newExchange</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public String append(String existing, String next) {
  return existing + next;
}</code></pre> </div> </div> <div class="paragraph"> <p>In the method below, we have only 4 parameters, so the 1st parameter is the body of the <code>oldExchange</code>, and the 2nd is the Map of the <code>oldExchange</code> headers, and the 3rd is paired to the body of the <code>newExchange</code>, and the 4th parameter is the Map of the <code>newExchange</code> headers:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public String append(String existing, Map existingHeaders, String next, Map nextHeaders) {
  return existing + next;
}</code></pre> </div> </div> <div class="paragraph"> <p>And finally if we have 6 parameters the we also have the properties of the Exchanges:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public String append(String existing, Map existingHeaders, Map existingProperties,
                     String next, Map nextHeaders, Map nextProperties) {
  return existing + next;
}</code></pre> </div> </div> <div class="paragraph"> <p>To use this with the Aggregate EIP we can use a POJO with the aggregate logic as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyBodyAppender {

    public String append(String existing, String next) {
        return next + existing;
    }

}</code></pre> </div> </div> <div class="paragraph"> <p>And then in the Camel route we create an instance of our bean, and then refer to the bean in the route using <code>bean</code> method from <code>org.apache.camel.builder.AggregationStrategies</code> as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private MyBodyAppender appender = new MyBodyAppender();

public void configure() throws Exception {
    from("direct:start")
        .aggregate(constant(true), AggregationStrategies.bean(appender, "append"))
            .completionSize(3)
            .to("mock:result");
}</code></pre> </div> </div> <div class="paragraph"> <p>We can also provide the bean type directly:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void configure() throws Exception {
    from("direct:start")
        .aggregate(constant(true), AggregationStrategies.bean(MyBodyAppender.class, "append"))
            .completionSize(3)
            .to("mock:result");
}</code></pre> </div> </div> <div class="paragraph"> <p>And if the bean has only one method we do not need to specify the name of the method:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void configure() throws Exception {
    from("direct:start")
        .aggregate(constant(true), AggregationStrategies.bean(MyBodyAppender.class))
            .completionSize(3)
            .to("mock:result");
}</code></pre> </div> </div> <div class="paragraph"> <p>And the <code>append</code> method could be static:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyBodyAppender {

    public static String append(String existing, String next) {
        return next + existing;
    }

}</code></pre> </div> </div> <div class="paragraph"> <p>If you are using XML DSL then we need to declare a &lt;bean&gt; with the POJO:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="myAppender" class="com.foo.MyBodyAppender"/&gt;</code></pre> </div> </div> <div class="paragraph"> <p>And in the Camel route we use <code>strategyRef</code> to refer to the bean by its id, and the <code>strategyMethodName</code> can be used to define the method name to call:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext xmlns="http://camel.apache.org/schema/spring"&gt;
    &lt;route&gt;
        &lt;from uri="direct:start"/&gt;
        &lt;aggregate strategyRef="myAppender" strategyMethodName="append" completionSize="3"&gt;
            &lt;correlationExpression&gt;
                &lt;constant&gt;true&lt;/constant&gt;
            &lt;/correlationExpression&gt;
            &lt;to uri="mock:result"/&gt;
        &lt;/aggregate&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre> </div> </div> <div class="paragraph"> <p>When using XML DSL you must define the POJO as a &lt;bean&gt;.</p> </div> </div> </div> <div class="sect1"> <h2 id="_aggregating_when_no_data"><a class="anchor" href="#_aggregating_when_no_data"></a>Aggregating when no data</h2> <div class="sectionbody"> <div class="paragraph"> <p>By default when using POJOs as AggregationStrategy, then the method is <strong>only</strong> invoked when there is data to be aggregated (by default). You can use the option <code>strategyMethodAllowNull</code> to configure this. Where as without using POJOs then you may have <code>null</code> as <code>oldExchange</code> or <code>newExchange</code> parameters. For example the Aggregate EIP will invoke the <code>AggregationStrategy</code> with <code>oldExchange</code> as null, for the first Exchange incoming to the aggregator. And then for subsequent <a href="exchange.html" class="page">Exchange</a>s then <code>oldExchange</code> and <code>newExchange</code> parameters are both not null.</p> </div> <div class="paragraph"> <p>Example with Content Enricher EIP and no data</p> </div> <div class="paragraph"> <p>Though with POJOs as <code>AggregationStrategy</code> we made this simpler and only call the method when <code>oldExchange</code> and <code>newExchange</code> is not null, as that would be the most common use-case. If you need to allow <code>oldExchange</code> or <code>newExchange</code> to be null, then you can configure this with the POJO using the <code>AggregationStrategyBeanAdapter</code> as shown below. On the bean adapter we call <code>setAllowNullNewExchange</code> to allow the new exchange to be <code>null</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void configure() throws Exception {
    AggregationStrategyBeanAdapter myStrategy = new AggregationStrategyBeanAdapter(appender, "append");
    myStrategy.setAllowNullOldExchange(true);
    myStrategy.setAllowNullNewExchange(true);

    from("direct:start")
        .pollEnrich("seda:foo", 1000, myStrategy)
            .to("mock:result");
}</code></pre> </div> </div> <div class="paragraph"> <p>This can be configured a bit easier using the <code>beanAllowNull</code> method from <code>AggregationStrategies</code> as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void configure() throws Exception {
    from("direct:start")
        .pollEnrich("seda:foo", 1000, AggregationStrategies.beanAllowNull(appender, "append"))
            .to("mock:result");
}</code></pre> </div> </div> <div class="paragraph"> <p>Then the <code>append</code> method in the POJO would need to deal with the situation that <code>newExchange</code> can be null:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyBodyAppender {

    public String append(String existing, String next) {
        if (next == null) {
            return "NewWasNull" + existing;
        } else {
            return existing + next;
        }
    }

}</code></pre> </div> </div> <div class="paragraph"> <p>In the example above we use the <a href="content-enricher.html" class="page">Content Enricher</a> EIP using <code>pollEnrich</code>. The <code>newExchange</code> will be null in the situation we could not get any data from the "seda:foo" endpoint, and therefore the timeout was hit after 1 second. So if we need to do some special merge logic we would need to set <code>setAllowNullNewExchange=true</code>, so the <code>append</code> method will be invoked. If we do not do that then when the timeout was hit, then the append method would normally not be invoked, meaning the <a href="content-enricher.html" class="page">Content Enricher</a> did not merge/change the message.</p> </div> <div class="paragraph"> <p>In XML DSL you would configure the <code>strategyMethodAllowNull</code> option and set it to true as shown below:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext xmlns="http://camel.apache.org/schema/spring"&gt;
    &lt;route&gt;
        &lt;from uri="direct:start"/&gt;
        &lt;aggregate strategyRef="myAppender"
                   strategyMethodName="append"
                   strategyMethodAllowNull="true"
                   completionSize="3"&gt;
            &lt;correlationExpression&gt;
                &lt;constant&gt;true&lt;/constant&gt;
            &lt;/correlationExpression&gt;
            &lt;to uri="mock:result"/&gt;
        &lt;/aggregate&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="_different_body_types"><a class="anchor" href="#_different_body_types"></a>Different body types</h2> <div class="sectionbody"> <div class="paragraph"> <p>When for example using <code>strategyMethodAllowNull</code> as true, then the parameter types of the message bodies does not have to be the same. For example suppose we want to aggregate from a <code>com.foo.User</code> type to a <code>List&lt;String&gt;</code> that contains the user name. We could code a POJO doing this as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static final class MyUserAppender {

    public List addUsers(List names, User user) {
        if (names == null) {
            names = new ArrayList();
        }
        names.add(user.getName());
        return names;
    }
}</code></pre> </div> </div> <div class="paragraph"> <p>Notice that the return type is a List which we want to contain the user names. The 1st parameter is the list of names, and then notice the 2nd parameter is the incoming <code>com.foo.User</code> type.</p> </div> </div> </div> </article> </main> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../../_/img/logo-d.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <dl> <dt>Overview</dt> <dd><a href="../../blog/">Blog</a></dd> <dd><a href="../../components/latest/">Components</a></dd> <dd><a href="../../download/">Download</a></dd> <dd><a href="../../manual/latest/getting-started.html">Getting started</a></dd> <dd><a href="../../manual/latest/faq.html">FAQ</a></dd> </dl> <dl> <dt>Community</dt> <dd><a href="../../community/support/">Support</a></dd> <dd><a href="../../manual/latest/contributing.html">Contributing</a></dd> <dd><a href="../../community/user-stories/">User stories</a></dd> <dd><a href="../../community/articles/">Articles</a></dd> <dd><a href="../../community/books/">Books</a></dd> <dd><a href="../../community/team/">Team</a></dd> </dl> <dl> <dt>About</dt> <dd><a href="../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p> &copy; 2004-2019 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> </div> </footer> <script src="../../_/js/site-f4f4dbc142.js"></script> <script async src="../../_/js/vendor/highlight-54157f17f1.js"></script> <script async src="../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> {
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Apache Camel",
  "url": "https://camel.apache.org",
  "sameAs": [
     "https://twitter.com/ApacheCamel"
  ],
  "logo": "../../_/img/logo-d.svg",
  "description": "Apache Camel  is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL."
} </script> <script type="application/ld+json"> { 
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Apache Camel",
        "item": "https://camel.apache.org"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "User manual",
        "item": "https://camel.apache.org/manual/latest/index.html"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "Enterprise Integration Patterns","item": "https://camel.apache.org/manual/latest/enterprise-integration-patterns.html"}
        ,
        {
        "@type": "ListItem",
        "position": 4,
        "name": "Aggregate EIP","item": "https://camel.apache.org/manual/latest/aggregate-eip.html"}
        ]
    } </script> </body> </html> 