<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Graceful Shutdown - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/manual/latest/graceful-shutdown.html"> <meta name="generator" content="Antora 2.1.0"> <link rel="stylesheet" href="../../_/css/site-7d9877dbe0.css"> <meta name="application-name" content="Apache Camel"> <link rel="manifest" href="../../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar"> <div class="navbar-brand"> <a class="nav-logo" href="../.."><span>Apache Camel</span></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item" href="../../news/">News</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Projects</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../projects/camel-k/">Camel K</a> <a class="navbar-item" href="../../projects/camel-quarkus/">Camel Quarkus</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Documentation</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../docs/getting-started/">Getting started</a> <a class="navbar-item" href="../../manual/latest/">User manual</a> <a class="navbar-item" href="../../components/latest/">Component reference</a> <a class="navbar-item" href="../../camel-k/latest/">Camel K</a> <a class="navbar-item" href="../../camel-quarkus/latest/">Camel Quarkus</a> </div> </div> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">Community</a> <div class="navbar-dropdown"> <a class="navbar-item" href="../../community/support/">Support</a> <a class="navbar-item" href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a> <a class="navbar-item" href="../../community/user-stories/">User stories</a> <a class="navbar-item" href="../../community/articles/">Articles</a> <a class="navbar-item" href="../../community/books/">Books</a> <a class="navbar-item" href="../../community/team/">Team</a> <a class="navbar-item" href="../../community/camel-extra/">Camel extra</a> </div> </div> <a class="navbar-item" href="../../download/">Download</a> <div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link" href="#">About</a> <div class="navbar-dropdown"> <a class="navbar-item" href="https://www.apache.org/events/current-event.html">Apache events</a> <a class="navbar-item" href="https://www.apache.org/licenses/">License</a> <a class="navbar-item" href="../../security/">Security</a> <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div> </div> </div> <div class="navbar-tools"> <a href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#github"/></svg></a> <a href="https://gitter.im/apache/apache-camel" title="Chat on Gitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#gitter"/></svg></a> <a href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon"><use xlink:href="../../_/img/brand-logos.svg#twitter"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <div class="body"> <div class="nav-container" data-component="manual" data-version="latest"> <aside class="nav"> <div class="panels"> <div class="nav-panel-menu is-active" data-panel="menu"> <nav class="nav-menu"> <h3 class="title"><a href="index.html">User manual</a></h3> <ul class="nav-list"> <li class="nav-item" data-depth="0"> <ul class="nav-list"> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <a class="nav-link" href="getting-started.html">Getting started</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="what-are-the-dependencies.html">What are the dependencies?</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <a class="nav-link" href="architecture.html">Architecture</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="async.html">Async</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="asynchronous-routing-engine.html">Asynchronous Routing Engine</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="backlogdebugger.html">Backlog debugger</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bam.html">Business Activity Monitoring</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="batch-consumer.html">Batch Consumer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-core.html">Core</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camelcontext.html">Context</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="endpoint.html">Endpoints</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="cep.html">Complex Event Processing</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="component.html">Component</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="debugger.html">Debugger</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="delay-interceptor.html">Delay interceptor</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dependency-injection.html">Dependency Injection</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dozer-type-conversion.html">Dozer Type Conversion</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bean-integration.html">Bean Integration</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bean-binding.html">Bean Binding</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="parameter-binding-annotations.html">Parameter Binding Annotations</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pojo-producing.html">POJO Producing</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pojo-consuming.html">POJO Consuming</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="error-handler.html">Error Handler</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchange.html">Message Exchange</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="using-exchange-pattern-annotations.html">Using Exchange pattern annotations</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="expression.html">Expressions</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="content-enricher.html">Content Enrichment</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="injector.html">Injector</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="intercept.html">Intercept</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="inversion-of-control-with-smart-defaults.html">Inversion Of Control With Smart Defaults</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="jmx.html">JMX</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="lifecycle.html">Camel Lifecycle</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="oncompletion.html">OnCompletion</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="predicate.html">Predicates</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="registry.html">Registry</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="route-builder.html">RouteBuilder</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="routes.html">Routes</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="transformer.html">Transformer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="validator.html">Validator</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="spring-remoting.html">Spring Remoting</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="hiding-middleware.html">Hidding Middleware</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <span class="nav-text">Domain Specific Languages</span> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dsl.html">Camel Domain Specific Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="java-dsl.html">Java DSL</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="spring.html">Spring support</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="groovy-dsl.html">Groovy DSL</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <a class="nav-link" href="using-osgi-blueprint-with-camel.html">Using OSGi blueprint with Camel</a> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <span class="nav-text">Supported expression languages</span> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="constant-language.html">Constant Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchangeProperty-language.html">ExchangeProperty Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="file-language.html">File Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="header-language.html">Header Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="ref-language.html">Ref Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="simple-language.html">Simple Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="tokenize-language.html">Tokenize Language</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <a class="nav-link" href="enterprise-integration-patterns.html">Enterprise Integration Patterns</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="aggregate-eip.html">Aggregate EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="batch-config-eip.html">Batch-config EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bean-eip.html">Bean EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="choice-eip.html">Choice EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="circuitBreaker-eip.html">Circuit Breaker EIP (deprecated)</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="claimCheck-eip.html">Claim Check EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="content-based-router-eip.html">Content Based Router</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="content-filter-eip.html">Content Filter</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="convertBodyTo-eip.html">Convert Body To EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="customLoadBalancer-eip.html">Custom Load Balancer EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="delay-eip.html">Delay EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dynamic-router.html">Dynamic Router</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dynamicRouter-eip.html">Dynamic Router EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="enrich-eip.html">Enrich EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="eventDrivenConsumer-eip.html">Event Driven Consumer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="failover-eip.html">Failover EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="filter-eip.html">Filter EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="from-eip.html">From EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="hystrix-eip.html">Hystrix EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="hystrixConfiguration-eip.html">Hystrix Configuration EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="idempotentConsumer-eip.html">Idempotent Consumer EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="inOnly-eip.html">In Only EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="inOut-eip.html">In Out EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="loadBalance-eip.html">Load Balance EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="log-eip.html">Log EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="loop-eip.html">Loop EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="marshal-eip.html">Marshal EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="multicast-eip.html">Multicast EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="onFallback-eip.html">On Fallback EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="otherwise-eip.html">Otherwise EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pipeline-eip.html">Pipeline EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pollEnrich-eip.html">Poll Enrich EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="process-eip.html">Process EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="random-eip.html">Random EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="recipientList-eip.html">Recipient List EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="removeHeader-eip.html">Remove Header EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="removeHeaders-eip.html">Remove Headers EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="removeProperties-eip.html">Remove Properties EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="removeProperty-eip.html">Remove Property EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="requestReply-eip.html">Request Reply</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="resequence-eip.html">Resequence EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="rollback-eip.html">Rollback EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="roundRobin-eip.html">Round Robin EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="routingSlip-eip.html">Routing Slip EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="saga-eip.html">Saga EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="sample-eip.html">Sample EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="script-eip.html">Script EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="serviceCall-eip.html">Service Call EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="setBody-eip.html">Set Body EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="setHeader-eip.html">Set Header EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="setOutHeader-eip.html">Set Out Header EIP (deprecated)</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="setProperty-eip.html">Set Property EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="sort-eip.html">Sort EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="split-eip.html">Split EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="step-eip.html">Step EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="sticky-eip.html">Sticky EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="stop-eip.html">Stop EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="stream-config-eip.html">Stream-config EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="threads-eip.html">Threads EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="throttle-eip.html">Throttle EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="to-eip.html">To EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="toD-eip.html">To D EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="topic-eip.html">Topic EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="transform-eip.html">Transform EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="unmarshal-eip.html">Unmarshal EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="validate-eip.html">Validate EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="weighted-eip.html">Weighted EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="when-eip.html">When EIP</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="wireTap-eip.html">Wire Tap EIP</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle"></button> <span class="nav-text">Frequently asked questions</span> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/can-i-get-commercial-support.html">Can I get commercial support?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/can-i-use-camel-on-java-14.html">Can I use Camel on Java 1.4?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/does-camel-work-on-ibms-jdk.html">Does Camel work on IBM&#8217;s JDK?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="support.html">How can I get help?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-get-the-source-code.html">How can I get the source code?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-compare-to-mule.html">How does Camel compare to Mule?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-compare-to-servicemix.html">How does Camel compare to ServiceMix?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-compare-to-servicemix-eip.html">How does Camel compare to ServiceMix EIP?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-compare-to-synapse.html">How does Camel compare to Synapse?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-work.html">How does Camel work?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-work-with-activemq.html">How does Camel work with ActiveMQ?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-work-with-servicemix.html">How does Camel work with ServiceMix?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-the-camel-api-compare-to.html">How does the Camel API compare to?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-the-website-work.html">How does the website work?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-become-a-committer.html">How do I become a committer?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-compile-the-code.html">How do I compile the code?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-edit-the-website.html">How do I edit the website?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-run-camel-using-java-webstart.html">How do I run Camel using Java WebStart?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/if-i-use-servicemix-when-should-i-use-camel.html">If I use ServiceMix when should I use Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/is-camel-an-esb.html">Is Camel an ESB?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/is-camel-ioc-friendly.html">Is Camel IoC friendly?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/running-camel-standalone.html">Running Camel standalone</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-are-the-dependencies.html">What are the dependencies?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-a-router.html">What is a router?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-camel.html">What is Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-the-license.html">What is the license?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-jars-do-i-need.html">What jars do I need?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="languages.html">What languages are supported?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-platforms-are-supported.html">What platforms are supported?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-the-name-camel.html">Why the name Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/classloader-issue-of-servicemix-camel-component.html">Classloader issue of servicemix-camel component</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-specify-which-method-to-use-when-using-beans-in-routes.html">How do I specify which method to use when using beans in routes?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-create-a-custom-component-or-endpoint.html">How can I create a custom component or endpoint?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-get-the-remote-connection-ip-address-from-the-camel-cxf-consumer-.html">How can I get the remote connection IP address from the camel-cxf consumer ?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-stop-a-route-from-a-route.html">How can I stop a route from a route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-webservice-clients-see-remote-faults-with-stacktraces-when-using-camel-cxf.html">How can webservice clients see remote faults with stacktraces when using camel-cxf?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-look-up-beans-and-endpoints.html">How does Camel look up beans and endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="configuring-camel.html">How do I add a component?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-change-the-logging.html">How do I change the logging?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-endpoints.html">How do I configure endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-password-options-on-camel-endpoints-without-the-value-being-encoded.html">How do I configure password options on Camel endpoints without the value being encoded?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-the-default-maximum-cache-size-for-producercache-or-producertemplate.html">How do I configure the default maximum cache size for ProducerCache or ProducerTemplate?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-the-maximum-endpoint-cache-size-for-camelcontext.html">How do I configure the maximum endpoint cache size for CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-debug-my-route.html">How do I debug my route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-disable-jmx.html">How do I disable JMX?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-enable-streams-when-debug-logging-messages-in-camel.html">How do I enable streams when debug logging messages in Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-handle-failures-when-consuming-for-example-from-a-ftp-server.html">How do I handle failures when consuming for example from a FTP server?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-import-rests-from-other-xml-files.html">How do I import rests from other XML files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-import-routes-from-other-xml-files.html">How do I import routes from other XML files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-let-jetty-match-wildcards.html">How do I let Jetty match wildcards?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-name-my-routes.html">How do I name my routes?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-restart-camelcontext.html">How do I restart CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retrieve-the-thrown-exception-during-processing-an-exchange.html">How do I retrieve the thrown Exception during processing an Exchange?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retry-failed-messages-forever.html">How do I retry failed messages forever?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retry-processing-a-message-from-a-certain-point-back-or-an-entire-route.html">How do I retry processing a message from a certain point back or an entire route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-reuse-the-contexttestsupport-class-in-my-unit-tests.html">How do I reuse the ContextTestSupport class in my unit tests?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-run-activemq-and-camel-in-jboss.html">How do I run ActiveMQ and Camel in JBoss?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-set-the-max-chars-when-debug-logging-messages-in-camel.html">How do I set the max chars when debug logging messages in Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-specify-time-period-in-a-human-friendly-syntax.html">How do I specify time period in a human friendly syntax?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-a-big-uber-jar.html">How do I use a big (uber) JAR?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-camel-inside-servicemix.html">How do I use Camel inside ServiceMix?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-spring-property-placeholder-with-camel-xml.html">How do I use Spring Property Placeholder with Camel XML?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-uris-with-parameters-in-xml.html">How do I use URIs with parameters in XML?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-write-a-custom-processor-which-sends-multiple-messages.html">How do I write a custom Processor which sends multiple messages?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-should-i-invoke-my-pojos-or-spring-services.html">How should I invoke my POJOs or Spring Services?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-should-i-package-applications-using-camel-and-activemq.html">How should I package applications using Camel and ActiveMQ?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-avoid-importing-bunch-of-cxf-packages-when-start-up-the-camel-cxf-endpoint-from-osgi-platform-.html">How to avoid importing bunch of cxf packages when start up the camel-cxf endpoint from OSGi platform?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-avoid-sending-some-or-all-message-headers.html">How to avoid sending some or all message headers?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-define-a-static-camel-converter-method-in-scala.html">How to define a static Camel converter method in Scala?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-remove-the-http-protocol-headers-in-the-camel-message.html">How to remove the http protocol headers in the camel message?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-send-the-same-message-to-multiple-endpoints.html">How to send the same message to multiple endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-switch-the-cxf-consumer-between-http-and-https-without-touching-the-spring-configuration.html">How to switch the CXF consumer between HTTP and HTTPS without touching the Spring configuration?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-use-a-dynamic-uri-in-to.html">How to use a dynamic URI in to()?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-validate-the-camel-1x-context-xml-from-apache-camel-web-site.html">How to validate the camel 1.x context xml from Apache Camel web site?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/is-there-an-ide.html">Is there an IDE?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/should-i-deploy-camel-inside-the-activemq-broker-or-in-another-application.html">Should I deploy Camel inside the ActiveMQ broker or in another application?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/using-camel-core-testsjar.html">Using camel-core-tests.jar</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/using-getin-or-getout-methods-on-exchange.html">Using getIn or getOut methods on Exchange</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-cant-i-use-sign-in-my-password.html">Why can&#8217;t I use + sign in my password?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-can-i-not-use-when-or-otherwise-in-a-java-camel-route.html">Why can I not use when or otherwise in a Java Camel route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-ftp-component-not-download-any-files.html">Why does FTP component not download any files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-my-file-consumer-not-pick-up-the-file-and-how-do-i-let-the-file-consumer-use-the-camel-error-handler.html">Why does my file consumer not pick up the file, and how do I let the file consumer use the Camel error handler?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-useoriginalmessage-with-error-handler-not-work-as-expected.html">Why does useOriginalMessage with error handler not work as expected?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-do-my-message-lose-its-headers-during-routing.html">Why do my message lose its headers during routing?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-my-message-body-empty.html">Why is my message body empty?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-my-processor-not-showing-up-in-jconsole.html">Why is my processor not showing up in JConsole?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-the-exception-null-when-i-use-onexception.html">Why is the exception null when I use onException?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-use-multiple-camelcontext.html">Why use multiple CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-enable-debug-logging.html">How do I enable debug logging?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-java-14-logging.html">How do I use Java 1.4 logging?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-log4j.html">How do I use log4j?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-invoke-camel-routes-from-jbi.html">How do I invoke Camel routes from JBI?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-make-my-jms-endpoint-transactional.html">How Do I Make My JMS Endpoint Transactional?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-set-the-mep-when-interacting-with-jbi.html">How do I set the MEP when interacting with JBI?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-the-direct-event-seda-and-vm-endpoints-compare.html">How do the direct, event, seda and vm endpoints compare?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-the-timer-and-quartz-endpoints-compare.html">How do the Timer and Quartz endpoints compare?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-my-jms-route-only-consume-one-message-at-once.html">Why does my JMS route only consume one message at once?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-beandefinitionstoreexception.html">Exception - BeanDefinitionStoreException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-javaxnamingnoinitialcontextexception.html">Exception - javax.naming.NoInitialContextException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-orgapachecamelnosuchendpointexception.html">Exception - org.apache.camel.NoSuchEndpointException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-orgxmlsaxsaxparseexception.html">Exception - org.xml.sax.SAXParseException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/memory-leak-when-adding-and-removing-routes-at-runtime.html">Memory leak when adding and removing routes at runtime</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-do-camel-throw-so-many-noclassdeffoundexception-on-startup.html">Why do Camel throw so many NoClassDefFoundException on startup?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-camel-use-too-many-threads-with-producertemplate.html">Why does Camel use too many threads with ProducerTemplate?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-maven-not-download-dependencies.html">Why does maven not download dependencies?</a> </li> </ul> </li> </ul> </li> </ul> </nav> </div> <div class="nav-panel-explore" data-panel="explore"> <div class="context"> <span class="title">User manual</span> <span class="version">latest</span> </div> <ul class="components"> <li class="component"> <span class="title">Apache Camel extensions for Quarkus</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-quarkus/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Apache Camel K</span> <ul class="versions"> <li class="version is-latest"> <a href="../../camel-k/latest/index.html">latest</a> </li> </ul> </li> <li class="component"> <span class="title">Component reference</span> <ul class="versions"> <li class="version is-latest"> <a href="../../components/latest/index.html">latest</a> </li> <li class="version"> <a href="../../components/2.x/index.html">2.x</a> </li> </ul> </li> <li class="component is-current"> <span class="title">User manual</span> <ul class="versions"> <li class="version is-current is-latest"> <a href="index.html">latest</a> </li> </ul> </li> </ul> </div> </div> </aside> </div> <main role="main"> <div class="toolbar" role="navigation"> <button class="nav-toggle"></button> <a href="index.html" class="home-link"></a> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">User manual</a></li> <li><a href="graceful-shutdown.html">Graceful Shutdown</a></li> </ul> </nav> <div class="edit-this-page"><a href="https://github.com/apache/camel/edit/master/docs/user-manual/modules/ROOT/pages/graceful-shutdown.adoc">Edit this Page</a></div> </div> <article class="doc"> <h1 class="page">Graceful Shutdown</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.2</strong></p> </div> <div class="paragraph"> <p>Camel now supports a pluggable shutdown strategy using <code>org.apache.camel.spi.ShutdownStrategy</code>. Its responsible for shutting down routes in a graceful manner. The other resources will still be handled by <a href="camelcontext.html" class="page">CamelContext</a> to shutdown. This leaves the problem at hand with properly shutting down all the routes in a reliable manner to the <code>ShutdownStrategy</code>.</p> </div> <div class="paragraph"> <p>Camel provides a default strategy in the <code>org.apache.camel.impl.DefaultShutdownStrategy</code> which is capable of doing that.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-DefaultShutdownStrategy"><a class="anchor" href="#GracefulShutdown-DefaultShutdownStrategy"></a>DefaultShutdownStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>The default strategy will gracefully shutdown routes:</p> </div> <div class="ulist"> <ul> <li> <p><strong>Camel 2.2:</strong> in the same order they was started</p> </li> <li> <p><strong>Camel 2.3:</strong> in the reverse order they was started. The option <code>shutdownRoutesInReverseOrder</code> can be used to use the old behavior.</p> </li> <li> <p>let pending and current in flight exchanges run to completion before shutting down</p> </li> <li> <p>using a timeout of 300 seconds which then forces a shutdown now</p> </li> </ul> </div> <div class="paragraph"> <p>You can configure the timeout, and whether it should shutdown now remaining routes when the timeout occurred or ignore. See the setters on the class.</p> </div> <div class="paragraph"> <p>It will output to log the progress during graceful shutdown as shown in an example below</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">2009-12-20 10:56:53,055 [main ] INFO DefaultCamelContext - Apache Camel
(CamelContext:camel-1) is stopping 2009-12-20 10:56:53,056 [main ] INFO
DefaultShutdownStrategy - Starting to graceful shutdown routes (timeout
300 seconds) 2009-12-20 10:56:53,059 [1: ShutdownTask] INFO
DefaultShutdownStrategy - Waiting as there are still 5 inflight
exchanges to complete before we can shutdown 2009-12-20 10:56:54,060 [1:
ShutdownTask] INFO DefaultShutdownStrategy - Waiting as there are still
4 inflight exchanges to complete before we can shutdown 2009-12-20
10:56:55,061 [1: ShutdownTask] INFO DefaultShutdownStrategy - Waiting as
there are still 3 inflight exchanges to complete before we can shutdown
2009-12-20 10:56:56,065 [1: ShutdownTask] INFO DefaultShutdownStrategy -
Waiting as there are still 2 inflight exchanges to complete before we
can shutdown 2009-12-20 10:56:57,066 [1: ShutdownTask] INFO
DefaultShutdownStrategy - Waiting as there are still 1 inflight
exchanges to complete before we can shutdown 2009-12-20 10:56:58,069
[main ] INFO DefaultShutdownStrategy - Graceful shutdown of routes
complete in 5 seconds. 2009-12-20 10:56:58,072 [main ] INFO
DefaultInflightRepository - Shutting down with no inflight exchanges.
2009-12-20 10:56:58,077 [main ] INFO DefaultCamelContext - Apache Camel
(CamelContext:camel-1) stopped</code></pre> </div> </div> <div class="paragraph"> <p>Notice how it waits while there are inflight exchanges still being processed before it can shutdown.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-Suppressingloggingduetotimeoutnotallowingallinflightmessagestocomplete"><a class="anchor" href="#GracefulShutdown-Suppressingloggingduetotimeoutnotallowingallinflightmessagestocomplete"></a>Suppressing logging due to timeout not allowing all inflight messages to complete</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.12</strong></p> </div> <div class="paragraph"> <p>If a graceful shutdown could not shutdown cleanly within the given timeout period, then Camel performs a more aggressive shutdown by forcing routes and thread pools etc to shutdown. And as well the routing engine will reject continue processing <a href="exchange.html" class="page">Exchange</a>s. If this happens you may see WARN logs about <a href="exchange.html" class="page">Exchange</a>s being rejected and other failures due the forced shutdown.</p> </div> <div class="paragraph"> <p>If you do not want to see these logs, you can suppress this by setting the option SuppressLoggingOnTimeout to true.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.getShutdownStrategy().setSuppressLoggingOnTimeout(true);</code></pre> </div> </div> <div class="paragraph"> <p>Notice the suppress is a "best effort" though there may still be some logs coming from 3rd party libraries and whatnot, which Camel cannot control.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-Logginginflightexchangeinformationontimeout"><a class="anchor" href="#GracefulShutdown-Logginginflightexchangeinformationontimeout"></a>Logging inflight exchange information on timeout</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.15</strong></p> </div> <div class="paragraph"> <p>If a graceful shutdown could not shutdown cleanly within the given timeout period, then Camel performs a more aggressive shutdown by forcing routes and thread pools etc to shutdown. When the timeout happens, then Camel logs information about the current inflight exchanges, which shows from which route the exchange origins, and where it currently is being routed. For example the logging below, shows that there is 1 inflight exchange, that origins from route1, and currently is still in route1 at the "delay1" node. The elapsed is time in millis how long at the current node (eg delay1) and duration is total time in mills.</p> </div> <div class="paragraph"> <p>If you enable DEBUG logging level on <code>org.apache.camel.impl.DefaultShutdownStrategy</code> then it logs the same inflight exchange information during graceful shutdown</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">2015-01-12 13:23:23,656 [ - ShutdownTask] INFO DefaultShutdownStrategy -
There are 1 inflight exchanges: InflightExchange:
[exchangeId=ID-davsclaus-air-62213-1421065401253-0-3,
fromRouteId=route1, routeId=route1, nodeId=delay1, elapsed=2007,
duration=2017]</code></pre> </div> </div> <div class="paragraph"> <p>If you do not want to see these logs, you can turn this off by setting the option logInflightExchangesOnTimeout to false.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">context.getShutdownStrategy().setLogInflightExchangesOnTimeout(false);</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-Controllingorderingofroutes"><a class="anchor" href="#GracefulShutdown-Controllingorderingofroutes"></a>Controlling ordering of routes</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can configure the order in which routes should be started, and thus also the same order they are being shutdown. See more at <a href="configuring-route-startup-ordering-and-autostartup.html" class="page">Configuring route startup ordering and autostartup</a>.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-Finegrainedconfiguration"><a class="anchor" href="#GracefulShutdown-Finegrainedconfiguration"></a>Fine grained configuration</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can control two areas that influence graceful shutdown in the Camel routing:</p> </div> <div class="ulist"> <ul> <li> <p><code>ShutdownRoute</code></p> </li> <li> <p><code>ShutdownRunningTask</code></p> </li> </ul> </div> <div class="paragraph"> <p>These options can be configured on two scopes: <code>context</code> and <code>route</code>. Where a route will fallback to the <code>context</code> scoped option, if not explicit configured. (same principle as <a href="error-handler.html" class="page">Error Handler</a>, etc.).</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-ShutdownRoute"><a class="anchor" href="#GracefulShutdown-ShutdownRoute"></a>ShutdownRoute</h2> <div class="sectionbody"> <div class="paragraph"> <p>This option can control how a given route should act during graceful shutdown. It has two values <code>Default</code> and <code>Defer</code>. The <code>Default</code> is obviously the default option which lets Camel shutdown the route as early as possible. The <code>Defer</code> is used to defer shutting down this route to a later stage. This is useful when other routes are dependent upon it. For example an internal route which other routes reuse.</p> </div> <div class="paragraph"> <p>For example in the route below we have two routes, where route 1 is dependent upon route 2. At shutdown we want route 1 to complete all its current messages and we also want the 2nd route to do this as well. So we can mark both routes to <code>Defer</code> but since route 1 is a <a href="../../components/latest/seda-component.html" class="page">SEDA</a> based route its <code>Defer</code> by default (it uses <code>ShutdownAware</code>).</p> </div> <div class="paragraph"> <p>A Java DSL based example to defer shutting down the 2nd</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.apache.camel.processor;

import java.io.File;
import java.util.concurrent.atomic.AtomicBoolean;

import org.apache.camel.Component;
import org.apache.camel.ContextTestSupport;
import org.apache.camel.Processor;
import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.component.file.FileConsumer;
import org.apache.camel.component.file.FileEndpoint;
import org.apache.camel.component.file.GenericFileOperations;
import org.apache.camel.component.mock.MockEndpoint;
import org.junit.Before;
import org.junit.Test;

import static org.apache.camel.ShutdownRoute.Defer;

public class ShutdownDeferTest extends ContextTestSupport {

    private static final AtomicBoolean CONSUMER_SUSPENDED = new AtomicBoolean();

    @Override
    @Before
    public void setUp() throws Exception {
        deleteDirectory("target/deferred");
        super.setUp();
    }

    @Test
    public void testShutdownDeferred() throws Exception {
        MockEndpoint bar = getMockEndpoint("mock:bar");
        bar.expectedMinimumMessageCount(1);

        template.sendBody("seda:foo", "A");
        template.sendBody("seda:foo", "B");
        template.sendBody("seda:foo", "C");
        template.sendBody("seda:foo", "D");
        template.sendBody("seda:foo", "E");

        assertMockEndpointsSatisfied();

        Thread.sleep(50);

        context.stop();

        assertFalse("Should not have been suspended", CONSUMER_SUSPENDED.get());
    }

    @Override
    protected RouteBuilder createRouteBuilder() throws Exception {
        return new RouteBuilder() {
            @Override
            // START SNIPPET: e1
            public void configure() throws Exception {
                from("seda:foo")
                    .startupOrder(1)
                    .to("file://target/deferred");

                // use file component to transfer files from route 1 -&gt; route 2 as it
                // will normally suspend, but by deferring this we can let route 1
                // complete while shutting down
                MyDeferFileEndpoint defer = new MyDeferFileEndpoint("file://target/deferred?initialDelay=0&amp;delay=10", getContext().getComponent("file"));
                defer.setFile(new File("target/deferred"));

                from(defer)
                    // defer shutting down this route as the 1st route depends upon it
                    .startupOrder(2).shutdownRoute(Defer)
                    .to("mock:bar");
            }
            // END SNIPPET: e1
        };
    }

    private static final class MyDeferFileEndpoint extends FileEndpoint {

        private MyDeferFileEndpoint(String endpointUri, Component component) {
            super(endpointUri, component);
        }

        @Override
        protected FileConsumer newFileConsumer(Processor processor, GenericFileOperations&lt;File&gt; operations) {
            return new FileConsumer(this, processor, operations, createGenericFileStrategy()) {
                @Override
                protected void doSuspend() throws Exception {
                    CONSUMER_SUSPENDED.set(true);
                    super.doSuspend();
                }
            };
        }
    }
}</code></pre> </div> </div> <div class="paragraph"> <p>Defer shutting down internal routes only</p> </div> <div class="paragraph"> <p>Its best to only defer shutting down internal routes only. As <strong>public</strong> routes should shutdown as quickly as possible otherwise it will just keep intake new messages which will delay the shutdown processor. Or even have it timeout if a lot of new messages keep coming in.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-ShutdownRunningTask"><a class="anchor" href="#GracefulShutdown-ShutdownRunningTask"></a>ShutdownRunningTask</h2> <div class="sectionbody"> <div class="paragraph"> <p>This option control how a given route consumer acts during shutdown. Most route consumer will only operate on a single task (message), however the <a href="batch-consumer.html" class="page">Batch Consumer</a> can operate on many messages (in a batch). This option is for those kind of consumers. By default it uses the option <code>CompleteCurrentTaskOnly</code> which mean that the current <em>in progress</em> task (message) will be completed and then the consumer will shutdown. The other option <code>CompleteAllTasks</code> allows the consumer to complete all the tasks (messages) before shutting down. For example a <a href="../../components/latest/file-component.html" class="page">File</a> consumer will process all the pending files it has picked up before shutting down.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.apache.camel.processor;

import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.atomic.AtomicInteger;

import org.apache.camel.ContextTestSupport;
import org.apache.camel.Exchange;
import org.apache.camel.Processor;
import org.apache.camel.ShutdownRunningTask;
import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.component.mock.MockEndpoint;
import org.junit.Before;
import org.junit.Test;

public class ShutdownCompleteAllTasksTest extends ContextTestSupport {

    private static String url = "file:target/pending?initialDelay=0&amp;delay=10";
    private static AtomicInteger counter = new AtomicInteger();
    private static CountDownLatch latch = new CountDownLatch(2);

    @Override
    @Before
    public void setUp() throws Exception {
        deleteDirectory("target/pending");
        super.setUp();

        template.sendBodyAndHeader(url, "A", Exchange.FILE_NAME, "a.txt");
        template.sendBodyAndHeader(url, "B", Exchange.FILE_NAME, "b.txt");
        template.sendBodyAndHeader(url, "C", Exchange.FILE_NAME, "c.txt");
        template.sendBodyAndHeader(url, "D", Exchange.FILE_NAME, "d.txt");
        template.sendBodyAndHeader(url, "E", Exchange.FILE_NAME, "e.txt");
    }

    @Test
    public void testShutdownCompleteAllTasks() throws Exception {
        // give it 30 seconds to shutdown
        context.getShutdownStrategy().setTimeout(30);

        // start route
        context.startRoute("foo");

        MockEndpoint bar = getMockEndpoint("mock:bar");
        bar.expectedMinimumMessageCount(1);

        assertMockEndpointsSatisfied();

        int batch = bar.getReceivedExchanges().get(0).getProperty(Exchange.BATCH_SIZE, int.class);

        // wait for latch
        latch.await(10, TimeUnit.SECONDS);

        // shutdown during processing
        context.stop();

        // should route all
        assertEquals("Should complete all messages", batch, counter.get());
    }

    @Override
    protected RouteBuilder createRouteBuilder() throws Exception {
        return new RouteBuilder() {
            @Override
            // START SNIPPET: e1
            public void configure() throws Exception {
                from(url).routeId("foo").noAutoStartup()
                    // let it complete all tasks during shutdown
                    .shutdownRunningTask(ShutdownRunningTask.CompleteAllTasks)
                    .process(new MyProcessor())
                    .to("mock:bar");
            }
            // END SNIPPET: e1
        };
    }

    public static class MyProcessor implements Processor {

        public void process(Exchange exchange) throws Exception {
            counter.incrementAndGet();
            latch.countDown();
        }
    }

}</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-JMXmanaged"><a class="anchor" href="#GracefulShutdown-JMXmanaged"></a>JMX managed</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <code>ShutdownStrategy</code> is JMX aware as well so you can manage it from a JMX console. For example you can change the timeout value.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-Shuttingdownindividualroutes"><a class="anchor" href="#GracefulShutdown-Shuttingdownindividualroutes"></a>Shutting down individual routes</h2> <div class="sectionbody"> <div class="paragraph"> <p><strong>Available as of Camel 2.3</strong> Its now possible to gracefully shutdown an individual route using <code>shutdownRoute(routeId)</code> method on <code>CamelContext</code>. Its also possible to provide a specific timeout to use instead of the default timeout settings using <code>shutdownRoute(routeId, timeout, timeUnit)</code>.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-Developerrelated"><a class="anchor" href="#GracefulShutdown-Developerrelated"></a>Developer related</h2> <div class="sectionbody"> <div class="paragraph"> <p>If you develop your own Camel component or want to implement your own shutdown strategy then read this section for details.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-ShutdownStrategy"><a class="anchor" href="#GracefulShutdown-ShutdownStrategy"></a>ShutdownStrategy</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can implement your own strategy to control the shutdown by implementing the <code>org.apache.camel.spi.ShutdownStrategy</code> and the set it on the <code>CamelContext</code> using the <code>setShutdownStrategy</code> method.</p> </div> <div class="paragraph"> <p>When using Spring XML you then just define a spring bean which implements the <code>org.apache.camel.spi.ShutdownStrategy</code> and Camel will look it up at startup and use it instead of its default. See more at <a href="advanced-configuration-of-camelcontext-using-spring.html" class="page">Advanced configuration of CamelContext using Spring</a>.</p> </div> </div> </div> <div class="sect1"> <h2 id="GracefulShutdown-ShutdownAware"><a class="anchor" href="#GracefulShutdown-ShutdownAware"></a>ShutdownAware</h2> <div class="sectionbody"> <div class="paragraph"> <p>The interface <code>org.apache.camel.spi.ShutdownAware</code> is an optional interface consumers can implement to have fine grained control during shutdown. The <code>ShutdownStrategy</code> must be able to deal with consumers which implement this interface. This interface was introduced to cater for in memory consumers such as <a href="../../components/latest/seda-component.html" class="page">SEDA</a> which potentially have a number of pending messages on its internal in memory queues. What this allows is to let it control the shutdown process to let it complete its pending messages.</p> </div> <div class="paragraph"> <p>The method <code>getPendingExchangesSize</code> should return the number of pending messages which reside on the in memory queues.<br> The method <code>deferShutdown</code> should return <code>true</code> to defer the shutdown to a later stage, when there are no more pending and inflight messages.</p> </div> <div class="paragraph"> <p><a href="batch-consumer.html" class="page">Batch Consumer</a> should implement <code>ShutdownAware</code> so they properly support the <code>ShutdownRunningTask</code> option. See <code>GenericFileConsumer</code> for an example.</p> </div> </div> </div> </article> </main> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../../_/img/logo-d.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <dl> <dt>Overview</dt> <dd><a href="../../news/">News</a></dd> <dd><a href="../../components/latest/">Components</a></dd> <dd><a href="../../download/">Download</a></dd> <dd><a href="../../docs/getting-started/">Getting started</a></dd> <dd><a href="../../manual/latest/faq.html">FAQ</a></dd> </dl> <dl> <dt>Community</dt> <dd><a href="../../community/support/">Support</a></dd> <dd><a href="https://github.com/apache/camel/blob/master/CONTRIBUTING.md">Contributing</a></dd> <dd><a href="../../community/user-stories/">User stories</a></dd> <dd><a href="../../community/articles/">Articles</a></dd> <dd><a href="../../community/books/">Books</a></dd> <dd><a href="../../community/team/">Team</a></dd> <dd><a href="../../community/camel-extra/">Camel extra</a></dd> </dl> <dl> <dt>About</dt> <dd><a href="../../acknowledgments/">Acknowledgments</a> </dd><dd><a target="_blank" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p> &copy; 2004-2019 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> </div> </footer> <script src="../../_/js/site-f4f4dbc142.js"></script> <script async src="../../_/js/vendor/highlight-54157f17f1.js"></script> <script async src="../../_/js/vendor/svg4everybody-195d47ce7d.js"></script> <script type="application/ld+json"> {
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Apache Camel",
  "url": "https://camel.apache.org",
  "sameAs": [
     "https://twitter.com/ApacheCamel"
  ],
  "logo": "../../_/img/logo-d.svg",
  "description": "Apache Camel  is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL."
} </script> <script type="application/ld+json"> { 
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Apache Camel",
        "item": "https://camel.apache.org"
        },
        {
        "@type": "ListItem",
        "position": 2,
        "name": "User manual",
        "item": "https://camel.apache.org/manual/latest/index.html"
        },
        {
        "@type": "ListItem",
        "position": 3,
        "name": "Graceful Shutdown","item": "https://camel.apache.org/manual/latest/graceful-shutdown.html"}
        ]
    } </script> </body> </html> 